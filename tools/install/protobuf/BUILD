# -*- python -*-

load(
    "@drake//tools:install.bzl",
    "cmake_config",
    "install",
    "install_cmake_config",
)
load("//tools:lint.bzl", "add_lint_tests")

package(default_visibility = ["//visibility:public"])

cmake_config(
    cps_file_name = "protobuf.cps",
    package = "protobuf",
)

# TODO(fbudin69500): Install protobuf-module.cmake and protobuf-options.cmake
install_cmake_config(package = "protobuf")  # Creates :install_cmake_config

# Excluded headers were computed by comparing the headers installed by default
# with this Bazel installation and the headers installed with protobuf CMake
# installation. The list of files in the respective installation directories
# can be computed with:
#   `find . -type f | sort > header.list`
# The resulting two lists of files can be compared with `diff` and updated to
# contain the path of the headers in the source directory by prepending
# src/google/protobuf/ to the header file paths.
excluded_headers = [
    "src/google/protobuf/compiler/cpp/cpp_enum_field.h",
    "src/google/protobuf/compiler/cpp/cpp_enum.h",
    "src/google/protobuf/compiler/cpp/cpp_extension.h",
    "src/google/protobuf/compiler/cpp/cpp_field.h",
    "src/google/protobuf/compiler/cpp/cpp_file.h",
    "src/google/protobuf/compiler/cpp/cpp_helpers.h",
    "src/google/protobuf/compiler/cpp/cpp_map_field.h",
    "src/google/protobuf/compiler/cpp/cpp_message_field.h",
    "src/google/protobuf/compiler/cpp/cpp_message.h",
    "src/google/protobuf/compiler/cpp/cpp_options.h",
    "src/google/protobuf/compiler/cpp/cpp_primitive_field.h",
    "src/google/protobuf/compiler/cpp/cpp_service.h",
    "src/google/protobuf/compiler/cpp/cpp_string_field.h",
    "src/google/protobuf/compiler/cpp/cpp_unittest.h",
    "src/google/protobuf/compiler/csharp/csharp_doc_comment.h",
    "src/google/protobuf/compiler/csharp/csharp_enum_field.h",
    "src/google/protobuf/compiler/csharp/csharp_enum.h",
    "src/google/protobuf/compiler/csharp/csharp_field_base.h",
    "src/google/protobuf/compiler/csharp/csharp_helpers.h",
    "src/google/protobuf/compiler/csharp/csharp_map_field.h",
    "src/google/protobuf/compiler/csharp/csharp_message_field.h",
    "src/google/protobuf/compiler/csharp/csharp_message.h",
    "src/google/protobuf/compiler/csharp/csharp_options.h",
    "src/google/protobuf/compiler/csharp/csharp_primitive_field.h",
    "src/google/protobuf/compiler/csharp/csharp_reflection_class.h",
    "src/google/protobuf/compiler/csharp/csharp_repeated_enum_field.h",
    "src/google/protobuf/compiler/csharp/csharp_repeated_message_field.h",
    "src/google/protobuf/compiler/csharp/csharp_repeated_primitive_field.h",
    "src/google/protobuf/compiler/csharp/csharp_source_generator_base.h",
    "src/google/protobuf/compiler/csharp/csharp_wrapper_field.h",
    "src/google/protobuf/compiler/java/java_context.h",
    "src/google/protobuf/compiler/java/java_doc_comment.h",
    "src/google/protobuf/compiler/java/java_enum_field.h",
    "src/google/protobuf/compiler/java/java_enum_field_lite.h",
    "src/google/protobuf/compiler/java/java_enum.h",
    "src/google/protobuf/compiler/java/java_enum_lite.h",
    "src/google/protobuf/compiler/java/java_extension.h",
    "src/google/protobuf/compiler/java/java_extension_lite.h",
    "src/google/protobuf/compiler/java/java_field.h",
    "src/google/protobuf/compiler/java/java_file.h",
    "src/google/protobuf/compiler/java/java_generator_factory.h",
    "src/google/protobuf/compiler/java/java_helpers.h",
    "src/google/protobuf/compiler/java/java_lazy_message_field.h",
    "src/google/protobuf/compiler/java/java_lazy_message_field_lite.h",
    "src/google/protobuf/compiler/java/java_map_field.h",
    "src/google/protobuf/compiler/java/java_map_field_lite.h",
    "src/google/protobuf/compiler/java/java_message_builder.h",
    "src/google/protobuf/compiler/java/java_message_builder_lite.h",
    "src/google/protobuf/compiler/java/java_message_field.h",
    "src/google/protobuf/compiler/java/java_message_field_lite.h",
    "src/google/protobuf/compiler/java/java_message.h",
    "src/google/protobuf/compiler/java/java_message_lite.h",
    "src/google/protobuf/compiler/java/java_name_resolver.h",
    "src/google/protobuf/compiler/java/java_options.h",
    "src/google/protobuf/compiler/java/java_primitive_field.h",
    "src/google/protobuf/compiler/java/java_primitive_field_lite.h",
    "src/google/protobuf/compiler/java/java_service.h",
    "src/google/protobuf/compiler/java/java_shared_code_generator.h",
    "src/google/protobuf/compiler/java/java_string_field.h",
    "src/google/protobuf/compiler/java/java_string_field_lite.h",
    "src/google/protobuf/compiler/javanano/javanano_enum_field.h",
    "src/google/protobuf/compiler/javanano/javanano_enum.h",
    "src/google/protobuf/compiler/javanano/javanano_extension.h",
    "src/google/protobuf/compiler/javanano/javanano_field.h",
    "src/google/protobuf/compiler/javanano/javanano_file.h",
    "src/google/protobuf/compiler/javanano/javanano_helpers.h",
    "src/google/protobuf/compiler/javanano/javanano_map_field.h",
    "src/google/protobuf/compiler/javanano/javanano_message_field.h",
    "src/google/protobuf/compiler/javanano/javanano_message.h",
    "src/google/protobuf/compiler/javanano/javanano_params.h",
    "src/google/protobuf/compiler/javanano/javanano_primitive_field.h",
    "src/google/protobuf/compiler/mock_code_generator.h",
    "src/google/protobuf/compiler/objectivec/objectivec_enum_field.h",
    "src/google/protobuf/compiler/objectivec/objectivec_enum.h",
    "src/google/protobuf/compiler/objectivec/objectivec_extension.h",
    "src/google/protobuf/compiler/objectivec/objectivec_field.h",
    "src/google/protobuf/compiler/objectivec/objectivec_file.h",
    "src/google/protobuf/compiler/objectivec/objectivec_map_field.h",
    "src/google/protobuf/compiler/objectivec/objectivec_message_field.h",
    "src/google/protobuf/compiler/objectivec/objectivec_message.h",
    "src/google/protobuf/compiler/objectivec/objectivec_oneof.h",
    "src/google/protobuf/compiler/objectivec/objectivec_primitive_field.h",
    "src/google/protobuf/compiler/package_info.h",
    "src/google/protobuf/compiler/subprocess.h",
    "src/google/protobuf/compiler/zip_writer.h",
    "src/google/protobuf/io/coded_stream_inl.h",
    "src/google/protobuf/io/package_info.h",
    "src/google/protobuf/map_lite_test_util.h",
    "src/google/protobuf/map_test_util.h",
    "src/google/protobuf/map_test_util_impl.h",
    "src/google/protobuf/package_info.h",
    "src/google/protobuf/reflection_internal.h",
    "src/google/protobuf/stubs/atomicops_internals_macosx.h",
    "src/google/protobuf/stubs/atomicops_internals_pnacl.h",
    "src/google/protobuf/stubs/int128.h",
    "src/google/protobuf/stubs/map_util.h",
    "src/google/protobuf/stubs/mathlimits.h",
    "src/google/protobuf/stubs/mathutil.h",
    "src/google/protobuf/stubs/status_macros.h",
    "src/google/protobuf/stubs/statusor.h",
    "src/google/protobuf/stubs/stringprintf.h",
    "src/google/protobuf/stubs/strutil.h",
    "src/google/protobuf/stubs/substitute.h",
    "src/google/protobuf/stubs/time.h",
    "src/google/protobuf/testing/file.h",
    "src/google/protobuf/testing/googletest.h",
    "src/google/protobuf/test_util.h",
    "src/google/protobuf/test_util_lite.h",
    "src/google/protobuf/util/internal/constants.h",
    "src/google/protobuf/util/internal/datapiece.h",
    "src/google/protobuf/util/internal/default_value_objectwriter.h",
    "src/google/protobuf/util/internal/error_listener.h",
    "src/google/protobuf/util/internal/expecting_objectwriter.h",
    "src/google/protobuf/util/internal/field_mask_utility.h",
    "src/google/protobuf/util/internal/json_escaping.h",
    "src/google/protobuf/util/internal/json_objectwriter.h",
    "src/google/protobuf/util/internal/json_stream_parser.h",
    "src/google/protobuf/util/internal/location_tracker.h",
    "src/google/protobuf/util/internal/mock_error_listener.h",
    "src/google/protobuf/util/internal/object_location_tracker.h",
    "src/google/protobuf/util/internal/object_source.h",
    "src/google/protobuf/util/internal/object_writer.h",
    "src/google/protobuf/util/internal/protostream_objectsource.h",
    "src/google/protobuf/util/internal/protostream_objectwriter.h",
    "src/google/protobuf/util/internal/proto_writer.h",
    "src/google/protobuf/util/internal/structured_objectwriter.h",
    "src/google/protobuf/util/internal/type_info.h",
    "src/google/protobuf/util/internal/type_info_test_helper.h",
    "src/google/protobuf/util/internal/utility.h",
    "src/google/protobuf/util/package_info.h",
]

install(
    name = "install",
    targets = [
        "@protobuf//:protobuf",
        "@protobuf//:protobuf_lite",
        "@protobuf//:protoc_lib",
        "@protobuf//:protoc",
    ],
    hdrs = ["@protobuf//:well_known_protos"],
    hdr_strip_prefix = ["src"],
    guess_hdrs = "PACKAGE",
    guess_hdrs_exclude = excluded_headers,
    docs = ["@protobuf//:LICENSE"],
    doc_dest = "share/doc/protobuf",
    allowed_externals = ["@protobuf//:protobuf"],
    deps = [":install_cmake_config"],
)

add_lint_tests()
