#!/bin/bash
#
# Python venv set-up script for Drake.
#
# Most users do NOT need to run this manually:
# - The drake/setup/install_prereqs.sh runs this automatically.
# - The Bazel repository.bzl logic ensures the sync is fresh.

set -eux -o pipefail

python_version=$(python3 -c \
    'import sys;print(".".join(map(str,sys.version_info[:2])))')

# Chdir to the Drake root.
cd $(dirname $0)/../../..

# Choose where everything should go.
venv_base=$(cd bazel-venv && pwd)
venv_jazzband="${venv_base}/venv.jazzband"
venv_drake="${venv_base}/venv.drake"

# Ensure site-packages exists at a known location.
ln -nsf python${python_version} "${venv_drake}/lib/python3"

# Run the pip-sync tool.
"${venv_jazzband}/bin/pip-sync" \
    --verbose \
    --python-executable="${venv_drake}/bin/python3" \
    requirements.txt
