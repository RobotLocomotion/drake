# This Dockerfile and the accompanying shell scripts and patch files are used
# by the project maintainers to create the precompiled vtk binaries that are
# downloaded during the build. They are neither called during the build nor
# expected to be called by most developers or users of the project.

ARG PLATFORM=ubuntu:20.04

# -----------------------------------------------------------------------------
# Create a base provisioned image.
# -----------------------------------------------------------------------------

FROM ${PLATFORM} AS base

ADD image/provision.sh /image/
ADD image/prereqs /image/

RUN /image/provision.sh

# -----------------------------------------------------------------------------
# Build VTK.
# -----------------------------------------------------------------------------

FROM base AS vtk

# clone_vtk needs vtk_common, add both first.
ADD image/clone_vtk.py /image/
ADD image/vtk_common.py /image/
RUN python3 /image/clone_vtk.py

ADD image/vtk_cmake_configure_args.py /image/
ADD image/build_and_package_vtk.py /image/
RUN python3 /image/build_and_package_vtk.py
