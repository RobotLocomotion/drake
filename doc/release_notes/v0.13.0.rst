*************
Drake v0.13.0
*************

Announcements
-------------

* Drake's `tutorials`_ continue to improve, now including:

  * Rendering that uses MultibodyPlant (`#12388`_)
  * Optimization using MultibodyPlant, focused on custom evaluators (`#12433`_, `#12443`_)

* Users who compile Drake from source as a bazel external (as in the `drake_bazel_external`_ pattern) should no longer set ``build --incompatible_remove_legacy_whole_archive=false`` in their projectâ€™s ``.bazelrc`` (`#12262`_).

Breaking changes since v0.12.0
------------------------------

These are breaking changes that did not undergo a deprecation period:

* Remove all Bazel machinery for protobuf message generation (`#12450`_).

Changes since v0.12.0:
----------------------

Dynamical Systems
~~~~~~~~~~~~~~~~~

New features

* TBD More syntactic sugar for SymbolicVectorSystemBuilder (`#12421`_)  # `state`, `input`, `parameter`, `dynamics`, and `output` setters have std::vector variants. So that a user can write `.dynamics({-x_[1], -x_[0] + 3})` instead of `.dynamics(Vector2<Expression>(-x_[1], -x_[0] + 3))`. Also add `SymbolicVectorSystem::dynamics_for_variable`.
* TBD Add SymbolicVectorSystemBuilder::LinearizeDynamics (`#12466`_)
* TBD Renames event collection merge methods (`#12357`_)

Fixes

* TBD Changed dt to h in integrator documentation (`#12392`_)
* TBD Updates integrator documentation (`#12350`_)  # Reorganizes the integrator documentation and documents initial step size behavior (and caveats).
* TBD Improve error message when cloning a non-root Context (`#12391`_)
* TBD Updates the documentation on the use of accuracy in the Context (`#12428`_)

Mathematical Program
~~~~~~~~~~~~~~~~~~~~

New features

* TBD Add MathematicalProgram::indeterminates_index() (`#12405`_)
* TBD Add matrix version of Environment::insert (`#12409`_)
* TBD Expression(0.0) re-uses the pointer of Expression::Zero() (`#12459`_)  # Given a scalar type T, Eigen assumes that the constructor for T(0) is idempotent. Consequently, it should not involve memory-allocation to avoid a memory leak. This is not a correct assumption and needs to be fixed, but it takes time to fix the upstream and use the latest version of Eigen. Here, we want to provide a workaround on our side. See https://github.com/RobotLocomotion/drake/issues/12453.
* TBD Add Evaluate for symbolic SparseMatrix (`#12406`_)  # Also rewrite GetDistinctVariables using Eigen's visit method.
* TBD Store indeterminates and decision variables in symbolic::Polynomial as members (`#11790`_)

Fixes

TBD

Multibody Dynamics
~~~~~~~~~~~~~~~~~~

New features
Fixes

* TBD Update stale instructions on subclassing Shape specification (`#12372`_)
* TBD Rename/simplify/reword MultibodyTreeElement to produce better doxygen (`#12352`_)
* TBD Simplify and deprecate ``get_`` accessors in shape specification API (`#12373`_)
* TBD Adds a query for signed distance between a single pair of geometries (`#12379`_)  # QueryObject has a new method. It attempts to produce a signed distance pair result between a user-specified pair of geometries.
* TBD Add sdf parsing for ellipsoids (`#12324`_)
* TBD geometry: create ellipsoid meshes (`#12323`_)
* TBD geometry: export volume and surface meshes and fields to VTK files (`#12311`_)
* TBD geometry: create pressure fields for ellipsoids and spheres in hydroelastic contact models (`#12333`_)
* TBD geometry: pressure fields in cylinders for hydroelastic contact model (`#12348`_)
* TBD geometry: enable soft/rigid sphere, box, cylinder, and ellipsoid in hydroelastic contact model (`#12358`_)
* TBD geometry: document QueryObject::ComputeContactSurfaces() (`#12413`_)
* TBD geometry: support rigid Mesh in ComputeContactSurfaces for hydroelastic (`#12455`_)  # It is for hydroelastic contact model. Mesh is not supported in other proximity queries, mostly because we cannot use FCL's mesh representation, which is a triangle soup without the concept of enclosing volume. However, we still need broadphase culling for Mesh geometries colliding with other geometries. Therefore, we have colliding trees of bounding boxes of Mesh separated from the trees of other geometries.
* TBD Add BoundingVolumeHierarchy class (`#12347`_)  # - add RigidMesh struct layer to hold the bvh, similar to the SoftMesh struct layer - create AABB tree with first pass on splitting branches based on axis spread, optimisations to come
* TBD Support collision queries with capsule (`#12343`_)
* TBD Tests for capsule support for distance to shape in proximity engine (`#12332`_)
* TBD Removed referring triangles from SurfaceMesh (`#12438`_)
* TBD Hydroelastic spatial force visualization (`#12378`_)  # Adds the ability to visualize spatial forces (force and moment) to drake visualizer.
* TBD Removing grad_H from ContactSurface (`#12432`_)  # We are no longer using the grad_h value to define the normal of the contact surface. Instead, we're using the triangle normals of the surface itself. So, we remove the field and change downstream references to use the face normal instead. This act revealed some imprecision in the documented and implemented behaviors of the triangle normals. Where appropriate new documentation has been added (and tested) to help clarify the expectations of normals.
* TBD fix show_hydroelastic_contact plugin of drake_visualizer (`#12417`_)
* TBD Added new generalized acceleration ports (`#12354`_)
* TBD Reverses the surface normal convention in ContactSurface (`#12463`_)
* TBD Documents forward dynamics algorithm and notation in MBT (`#12317`_)
* TBD Reorder and regroup MBPlant API (`#12342`_)
* TBD Provide access to owning MBPlant from any MBElement (`#12380`_)
* TBD Change MBP's TAMSI solver success assertion into an exception (`#12361`_)  # with a detailed description of possible causes/actions.
* TBD Implements ABA forward dynamics (`#12412`_)
* TBD Fixes qdot-to-v mapping (and back) for discrete MultibodyPlant (`#12355`_)
* TBD Adds missing operators to SpatialVector (`#12436`_)
* TBD Make effective use of SpatialAcceleration's addition operators (`#12462`_)
* TBD Improve RollPitchYaw and RotationMatrix class documentation (#12345) (`#12345`_)

Miscellaneous features and fixes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Visualizer changes:

* Fix: Update image_show.py for Python 3 (`#12422`_)
* Fix: Avoid negative real time factors (`#12444`_)

pydrake bindings
~~~~~~~~~~~~~~~~

* TBD DistanceConstraint (`#12346`_)
* TBD System.SetDefaultContext (`#12368`_)
* TBD Simulator.reset_context (`#12368`_)
* TBD overloaded AddQuadraticCost (`#12375`_)
* TBD AddConstraint (`#12371`_)
* TBD py geometry: Ensure all submodules are part of .all (`#12383`_)
* TBD tree.world_model_instance (`#12389`_)
* TBD tree.default_model_instance (`#12389`_)
* TBD geometry properties and role assignment (`#12389`_)
* TBD geometry casting RenderLabel to int (`#12390`_)
* TBD geometry property retrieval (`#12388`_)
* TBD ComputeSignedDistancePairClosestPoints (`#12408`_)
* TBD RevoluteSpring (`#12481`_)
* Fix: Ensure system names get copied for scalar conversion (`#12429`_)
* TBD Use lcm encoding (not protobuf) for call_python RPCs (`#12442`_)
* TBD Reverts /pydrake/manipulation/simple_ui #11560 (`#12486`_)  # , which had multiple defects (described on that github issue), and which broke the existing uses.
* TBD pydrake/systems/planar_scenegraph_visualizer .pyPort planar_scenegraph_visualizer from underactuated (`#12218`_, `#12349`_)
* Fix: Sphinx shows ``__init__`` documentation in Python 3 (`#12452`_)

Build system and dependencies
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

* Provide nightly binary docker images (`#10554`_, `#12364`_, `#12367`_, `#12446`_)
* Fix missing pthread linkopts for MOSEK (`#12337`_)
* Fix variable name in FindTinyXML2 (`#12339`_)
* Fix ByteSizeLong for Protobuf 3.11.0 or above (`#12425`_)
* Fix linters' find_all_sources --all commands (`#12369`_, `#12385`_, `#12424`_)
* Fix doxygen dot path (`#12416`_)
* Add pkg-config as binary dependency (`#12339`_)
* Add pandas as a source dependency (`#12328`_)
* Add rules_python as a source dependency for python, and define use a toolchain for Python (`#12377`_)
* Change graphviz from source dependency to binary dependency (`#12340`_)
* Change jupyter notebook and ipywidgets from source dependencies to binary dependencies in anticipation of installing Drake's tutorial notebooks (`#12461`_)
* Upgrade meshcat_python to latest commit (`#12365`_)
* Upgrade fcl to latest commit (`#12395`_)
* Upgrade ghc_filesystem to latest release 1.2.8 (`#12395`_)
* Upgrade ignition_math to latest release 6.4.0 (`#12395`_)
* Upgrade json to latest release 3.7.3 (`#12395`_)
* Upgrade lcm to latest commit (`#12457`_)
* Upgrade meshcat to latest commit (`#12395`_)
* Upgrade optitrack-driver to latest commit (`#12377`_)
* Upgrade sdformat to latest release 8.6.0 (`#12395`_)
* Upgrade semantic_version to latest release 2.8.3 (`#12395`_)
* Upgrade octomap to latest release 1.9.1 (`#12426`_)
* Upgrade ghc_filesystem to latest release 1.2.10 (`#12426`_)
* Upgrade fmt to latest release 6.1.2 (`#12426`_, `#12487`_)
* Upgrade supported Bazel version to 1.2 (`#12396`_)
* Upgrade supported macOS CMake version to 3.16  (`#12396`_)
* Upgrade supported macOS Xcode version to 11.2 (`#12331`_)
* Un-pin sphinx for macOS (`#12467`_)
* Do not install Python 2.7 on Mac (`#12339`_)
* Remove all Bazel machinery for protobuf message generation (`#12450`_), specifically:

  * @com_google_protobuf//...
  * @drake//:protobuf
  * @drake//:protobuf_python
  * @drake//:protoc
  * @drake//tools/skylark:drake_proto.bzl
  * @protoc//...

* Add experimental drake_bazel_installed support (`#12402`_)

Newly-deprecated APIs
~~~~~~~~~~~~~~~~~~~~~

* drake::common::NewPythonVariable (`#12442`_)
* drake::multibody::MultibodyTreeElement (`#12352`_)
* drake::geometry::Sphere::get_radius (`#12373`_)
* drake::geometry::Cylinder::get_radius (`#12373`_)
* drake::geometry::Cylinder::get_length (`#12373`_)
* drake::geometry::Capsule::get_radius (`#12373`_)
* drake::geometry::Capsule::get_length (`#12373`_)
* drake::geometry::Ellipsoid::get_a (`#12373`_)
* drake::geometry::Ellipsoid::get_b (`#12373`_)
* drake::geometry::Ellipsoid::get_c (`#12373`_)

Removal of deprecated APIs
~~~~~~~~~~~~~~~~~~~~~~~~~~

* drake::common::MatlabRPC (`#12431`_)

  * Use PythonRemoteMessage instead.")

* drake::common::MatlabArray (`#12431`_)

  * Use PythonRemoteData instead.

* drake::common::ToMatlabArray (`#12431`_)

  * Use ToPythonRemoteData instead.

* drake::math::RigidTransform::FromMatrix4 (`#12431`_)

  * Use the ``pose=`` constructor instead.

* drake::geometry::ContactSurface::mesh (`#12431`_)

  * Use mesh_W instead.

* drake::geometry::SurfaceVertex::Transform (`#12431`_)

  * Use TransformInPlace instead.

* pydrake.multibody.ContactResults.num_contacts (`#12431`_)

  * Use num_point_pair_contacts instead.

* pydrake.multibody.ContactResults.contact_info (`#12431`_)

  * Use point_pair_contact_info instead.

* pydrake Eigen.Quaternion.multiply with ``position=`` kwargs (`#12431`_)

  * Use ``vector=`` instead of ``position=``.

This release provides `pre-compiled binaries <https://github.com/RobotLocomotion/drake/releases/tag/v0.13.0>`__ named ``drake-TBD-{bionic|mac}.tar.gz``. See https://drake.mit.edu/from_binary.html#nightly-releases for instructions on how to use them

Drake binary releases incorporate a pre-compiled version of `SNOPT <https://ccom.ucsd.edu/~optimizers/solvers/snopt/>`__ as part of the `Mathematical Program toolbox <https://drake.mit.edu/doxygen_cxx/group__solvers.html>`__. Thanks to Philip E. Gill and Elizabeth Wong for their kind support.

.. _drake_bazel_external: https://github.com/RobotLocomotion/drake-external-examples/tree/master/drake_bazel_external
.. _tutorials: https://github.com/RobotLocomotion/drake/tree/master/tutorials

.. _#10554: https://github.com/RobotLocomotion/drake/pull/10554
.. _#11790: https://github.com/RobotLocomotion/drake/pull/11790
.. _#12218: https://github.com/RobotLocomotion/drake/pull/12218
.. _#12262: https://github.com/RobotLocomotion/drake/pull/12262
.. _#12311: https://github.com/RobotLocomotion/drake/pull/12311
.. _#12317: https://github.com/RobotLocomotion/drake/pull/12317
.. _#12323: https://github.com/RobotLocomotion/drake/pull/12323
.. _#12324: https://github.com/RobotLocomotion/drake/pull/12324
.. _#12328: https://github.com/RobotLocomotion/drake/pull/12328
.. _#12331: https://github.com/RobotLocomotion/drake/pull/12331
.. _#12332: https://github.com/RobotLocomotion/drake/pull/12332
.. _#12333: https://github.com/RobotLocomotion/drake/pull/12333
.. _#12337: https://github.com/RobotLocomotion/drake/pull/12337
.. _#12339: https://github.com/RobotLocomotion/drake/pull/12339
.. _#12340: https://github.com/RobotLocomotion/drake/pull/12340
.. _#12342: https://github.com/RobotLocomotion/drake/pull/12342
.. _#12343: https://github.com/RobotLocomotion/drake/pull/12343
.. _#12345: https://github.com/RobotLocomotion/drake/pull/12345
.. _#12346: https://github.com/RobotLocomotion/drake/pull/12346
.. _#12347: https://github.com/RobotLocomotion/drake/pull/12347
.. _#12348: https://github.com/RobotLocomotion/drake/pull/12348
.. _#12349: https://github.com/RobotLocomotion/drake/pull/12349
.. _#12350: https://github.com/RobotLocomotion/drake/pull/12350
.. _#12352: https://github.com/RobotLocomotion/drake/pull/12352
.. _#12354: https://github.com/RobotLocomotion/drake/pull/12354
.. _#12355: https://github.com/RobotLocomotion/drake/pull/12355
.. _#12357: https://github.com/RobotLocomotion/drake/pull/12357
.. _#12358: https://github.com/RobotLocomotion/drake/pull/12358
.. _#12361: https://github.com/RobotLocomotion/drake/pull/12361
.. _#12364: https://github.com/RobotLocomotion/drake/pull/12364
.. _#12365: https://github.com/RobotLocomotion/drake/pull/12365
.. _#12367: https://github.com/RobotLocomotion/drake/pull/12367
.. _#12368: https://github.com/RobotLocomotion/drake/pull/12368
.. _#12369: https://github.com/RobotLocomotion/drake/pull/12369
.. _#12371: https://github.com/RobotLocomotion/drake/pull/12371
.. _#12372: https://github.com/RobotLocomotion/drake/pull/12372
.. _#12373: https://github.com/RobotLocomotion/drake/pull/12373
.. _#12375: https://github.com/RobotLocomotion/drake/pull/12375
.. _#12377: https://github.com/RobotLocomotion/drake/pull/12377
.. _#12378: https://github.com/RobotLocomotion/drake/pull/12378
.. _#12379: https://github.com/RobotLocomotion/drake/pull/12379
.. _#12380: https://github.com/RobotLocomotion/drake/pull/12380
.. _#12383: https://github.com/RobotLocomotion/drake/pull/12383
.. _#12385: https://github.com/RobotLocomotion/drake/pull/12385
.. _#12388: https://github.com/RobotLocomotion/drake/pull/12388
.. _#12389: https://github.com/RobotLocomotion/drake/pull/12389
.. _#12390: https://github.com/RobotLocomotion/drake/pull/12390
.. _#12391: https://github.com/RobotLocomotion/drake/pull/12391
.. _#12392: https://github.com/RobotLocomotion/drake/pull/12392
.. _#12395: https://github.com/RobotLocomotion/drake/pull/12395
.. _#12396: https://github.com/RobotLocomotion/drake/pull/12396
.. _#12402: https://github.com/RobotLocomotion/drake/pull/12402
.. _#12405: https://github.com/RobotLocomotion/drake/pull/12405
.. _#12406: https://github.com/RobotLocomotion/drake/pull/12406
.. _#12408: https://github.com/RobotLocomotion/drake/pull/12408
.. _#12409: https://github.com/RobotLocomotion/drake/pull/12409
.. _#12412: https://github.com/RobotLocomotion/drake/pull/12412
.. _#12413: https://github.com/RobotLocomotion/drake/pull/12413
.. _#12416: https://github.com/RobotLocomotion/drake/pull/12416
.. _#12417: https://github.com/RobotLocomotion/drake/pull/12417
.. _#12421: https://github.com/RobotLocomotion/drake/pull/12421
.. _#12422: https://github.com/RobotLocomotion/drake/pull/12422
.. _#12424: https://github.com/RobotLocomotion/drake/pull/12424
.. _#12425: https://github.com/RobotLocomotion/drake/pull/12425
.. _#12426: https://github.com/RobotLocomotion/drake/pull/12426
.. _#12428: https://github.com/RobotLocomotion/drake/pull/12428
.. _#12429: https://github.com/RobotLocomotion/drake/pull/12429
.. _#12431: https://github.com/RobotLocomotion/drake/pull/12431
.. _#12432: https://github.com/RobotLocomotion/drake/pull/12432
.. _#12433: https://github.com/RobotLocomotion/drake/pull/12433
.. _#12436: https://github.com/RobotLocomotion/drake/pull/12436
.. _#12438: https://github.com/RobotLocomotion/drake/pull/12438
.. _#12442: https://github.com/RobotLocomotion/drake/pull/12442
.. _#12443: https://github.com/RobotLocomotion/drake/pull/12443
.. _#12444: https://github.com/RobotLocomotion/drake/pull/12444
.. _#12446: https://github.com/RobotLocomotion/drake/pull/12446
.. _#12450: https://github.com/RobotLocomotion/drake/pull/12450
.. _#12452: https://github.com/RobotLocomotion/drake/pull/12452
.. _#12455: https://github.com/RobotLocomotion/drake/pull/12455
.. _#12457: https://github.com/RobotLocomotion/drake/pull/12457
.. _#12458: https://github.com/RobotLocomotion/drake/pull/12458
.. _#12459: https://github.com/RobotLocomotion/drake/pull/12459
.. _#12461: https://github.com/RobotLocomotion/drake/pull/12461
.. _#12462: https://github.com/RobotLocomotion/drake/pull/12462
.. _#12463: https://github.com/RobotLocomotion/drake/pull/12463
.. _#12466: https://github.com/RobotLocomotion/drake/pull/12466
.. _#12467: https://github.com/RobotLocomotion/drake/pull/12467
.. _#12481: https://github.com/RobotLocomotion/drake/pull/12481
.. _#12486: https://github.com/RobotLocomotion/drake/pull/12486
.. _#12487: https://github.com/RobotLocomotion/drake/pull/12487

..
  Commits to be categorized
  Current oldest_commit bda9c0f2d2f06bd16f9fc659d976b7bea1fd3216 (inclusive).
  Current newest_commit ebd51d63b19c0b213c0de2517c9c70e116abccce (inclusive).
