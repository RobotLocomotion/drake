*************
Drake v0.22.0
*************

Announcements
-------------

TBD

Breaking changes since v0.21.0
------------------------------

* drake::multibody::Joint gained a new pure virtual method do_set_default_positions (`#13757`_)
* pydrake's deprecation infrastructure now must always be given a removal date, either embedded in the message or via the new date= kwarg (`#13730`_)
* Several stale forks of SDFormat models were removed from the Atlas example (`#13758`_)

Changes since v0.21.0:
----------------------

Dynamical Systems
~~~~~~~~~~~~~~~~~

New features

* TBD

Fixes

* Extract DiagramState into its own file (`#13839`_)

Mathematical Program
~~~~~~~~~~~~~~~~~~~~

New features

* Add GetKnownSolvers (`#13821`_)
* Add three examples of sum-of-squares optimization (`#13719`_, `#13746`_, `#13759`_, `#13765`_)
* Improve polynomial-related support:

  * MathematicalProgramResult::GetSolution also works for a polynomial (`#13748`_)
  * Add symbolic ChebyshevPolynomial, ChebyshevBasisElement, PolynomialBasisElement (`#13751`_, `#13796`_)

Fixes

* Fix out-of-bounds matrix access in Autodiff QuadraticCost (`#13752`_)

Multibody Dynamics
~~~~~~~~~~~~~~~~~~

New features

* Add PlanarMobilizer and PlanarJoint (`#13711`_, `#13747`_, `#13813`_)
* Add support for parsing SDF and URDF from strings (`#13814`_, `#13826`_)

Fixes

* Make contact results deterministic (`#13737`_)
* Contact results will differ slightly from prior releases (`#13734`_)
* Joint::set_default_positions updates the underlying mobilizer (`#13757`_)
* Fix formatting in TAMSI error message (`#13802`_)

Tutorials and examples
~~~~~~~~~~~~~~~~~~~~~~

* Add support for "planar visualization" in meshcat (`#13755`_)
* Use planar visualization in the ManipulationStation demos (`#13755`_)
* Add example of a cloth system modeled as a collection of springs (`#13714`_)

Miscellaneous features and fixes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

* Reformat all XML files with xmllint (`#13768`_)
* Upgrade all models to use SDFormat 1.7 syntax (`#13772`_, `#13774`_, `#13758`_)
* drake-visualizer: Mitigate z-fighting between display grid and ground plane (`#13829`_)
* yaml: Add YamlWriteArchive::EraseMatchingMaps (`#13699`_)

pydrake bindings
~~~~~~~~~~~~~~~~

New features

* Redirect drake's logs to the Python ``logging`` module instead of stderr (`#13568`_, `#13781`_)
* Deprecation annotations may pass a date=YYYY-MM-DD kwarg (`#13730`_)

Newly bound

* pydrake.common.eigen_geometry.Quaternion.slerp (`#13810`_)

Build system and dependencies
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

* Add preliminary support for bootstrapping Google Colab (`#13697`_, `#13795`_)
* Rename libspdlog.so to libdrake_spdlog.so (`#13698`_)
* Upgrade recommended Bazel version to 3.4 (`#13743`_)
* Upgrade buildifier to latest release 3.4.0 (`#13791`_)
* Upgrade fcl to latest commit (`#13787`_)
* Upgrade fmt to latest release 7.0.2 (`#13788`_)
* Upgrade meshcat to latest commit (`#13755`_)
* Upgrade meshcat_python to latest commit (`#13755`_, `#13806`_)
* Upgrade models to latest commit (`#13786`_)
* Upgrade pybind11 fork to latest commit (`#13801`_)
* Upgrade ros_xacro to latest release 1.13.6 (`#13790`_)
* Upgrade scs to latest release 2.1.2 (`#13789`_)
* Upgrade styleguide latest commit (`#13804`_)
* Do not install gl_renderer's private headers (`#13807`_)
* Prune unwanted dependencies (`#13753`_, `#13827`_, `#13830`_)

  * The install_prereqs script for source builds now offers a --without-test-only option to install only the dependencies needed to compile and install Drake, omitting dependencies only required for testing.

Newly-deprecated APIs
~~~~~~~~~~~~~~~~~~~~~

* drake::math::Slerp (`#13810`_)
* examples/irb140/urdf/** (`#13831`_)
* examples/kuka_iiwa_arm/models/objects/big_robot_toy.urdf (`#13831`_)

Removal of deprecated items
~~~~~~~~~~~~~~~~~~~~~~~~~~~

* drake::Polynomial::IsApprox (`#13785`_)
* drake::systems::Simulator::reset_integrator (`#13785`_)
* drake::trajectories::PiecewisePolynomial<T>::PolynomialType (`#13785`_)
* pydrake.polynomial.Polynomial.IsApprox (`#13785`_)
* pydrake.systems.analysis.Simulator.reset_integrator (`#13785`_)
* pydrake.systems.framework.AbstractValue (`#13785`_)
* pydrake.systems.framework.Value (`#13785`_)
* The bitbucket.bzl macros (`#13785`_)
* The tinydir external (`#13785`_)

Notes
-----

This release provides `pre-compiled binaries
<https://github.com/RobotLocomotion/drake/releases/tag/v0.22.0>`__ named
``drake-YYYYMMDD-{bionic|focal|mac}.tar.gz``. See :ref:`Nightly Releases
<nightly-releases>` for instructions on how to use them.

Drake binary releases incorporate a pre-compiled version of `SNOPT
<https://ccom.ucsd.edu/~optimizers/solvers/snopt/>`__ as part of the
`Mathematical Program toolbox
<https://drake.mit.edu/doxygen_cxx/group__solvers.html>`__. Thanks to
Philip E. Gill and Elizabeth Wong for their kind support.

.. _#13568: https://github.com/RobotLocomotion/drake/pull/13568
.. _#13697: https://github.com/RobotLocomotion/drake/pull/13697
.. _#13698: https://github.com/RobotLocomotion/drake/pull/13698
.. _#13699: https://github.com/RobotLocomotion/drake/pull/13699
.. _#13711: https://github.com/RobotLocomotion/drake/pull/13711
.. _#13714: https://github.com/RobotLocomotion/drake/pull/13714
.. _#13719: https://github.com/RobotLocomotion/drake/pull/13719
.. _#13730: https://github.com/RobotLocomotion/drake/pull/13730
.. _#13734: https://github.com/RobotLocomotion/drake/pull/13734
.. _#13737: https://github.com/RobotLocomotion/drake/pull/13737
.. _#13743: https://github.com/RobotLocomotion/drake/pull/13743
.. _#13746: https://github.com/RobotLocomotion/drake/pull/13746
.. _#13747: https://github.com/RobotLocomotion/drake/pull/13747
.. _#13748: https://github.com/RobotLocomotion/drake/pull/13748
.. _#13751: https://github.com/RobotLocomotion/drake/pull/13751
.. _#13752: https://github.com/RobotLocomotion/drake/pull/13752
.. _#13753: https://github.com/RobotLocomotion/drake/pull/13753
.. _#13755: https://github.com/RobotLocomotion/drake/pull/13755
.. _#13757: https://github.com/RobotLocomotion/drake/pull/13757
.. _#13758: https://github.com/RobotLocomotion/drake/pull/13758
.. _#13759: https://github.com/RobotLocomotion/drake/pull/13759
.. _#13765: https://github.com/RobotLocomotion/drake/pull/13765
.. _#13768: https://github.com/RobotLocomotion/drake/pull/13768
.. _#13772: https://github.com/RobotLocomotion/drake/pull/13772
.. _#13774: https://github.com/RobotLocomotion/drake/pull/13774
.. _#13781: https://github.com/RobotLocomotion/drake/pull/13781
.. _#13785: https://github.com/RobotLocomotion/drake/pull/13785
.. _#13786: https://github.com/RobotLocomotion/drake/pull/13786
.. _#13787: https://github.com/RobotLocomotion/drake/pull/13787
.. _#13788: https://github.com/RobotLocomotion/drake/pull/13788
.. _#13789: https://github.com/RobotLocomotion/drake/pull/13789
.. _#13790: https://github.com/RobotLocomotion/drake/pull/13790
.. _#13791: https://github.com/RobotLocomotion/drake/pull/13791
.. _#13795: https://github.com/RobotLocomotion/drake/pull/13795
.. _#13796: https://github.com/RobotLocomotion/drake/pull/13796
.. _#13801: https://github.com/RobotLocomotion/drake/pull/13801
.. _#13802: https://github.com/RobotLocomotion/drake/pull/13802
.. _#13804: https://github.com/RobotLocomotion/drake/pull/13804
.. _#13806: https://github.com/RobotLocomotion/drake/pull/13806
.. _#13807: https://github.com/RobotLocomotion/drake/pull/13807
.. _#13810: https://github.com/RobotLocomotion/drake/pull/13810
.. _#13813: https://github.com/RobotLocomotion/drake/pull/13813
.. _#13814: https://github.com/RobotLocomotion/drake/pull/13814
.. _#13821: https://github.com/RobotLocomotion/drake/pull/13821
.. _#13826: https://github.com/RobotLocomotion/drake/pull/13826
.. _#13827: https://github.com/RobotLocomotion/drake/pull/13827
.. _#13829: https://github.com/RobotLocomotion/drake/pull/13829
.. _#13830: https://github.com/RobotLocomotion/drake/pull/13830
.. _#13831: https://github.com/RobotLocomotion/drake/pull/13831
.. _#13839: https://github.com/RobotLocomotion/drake/pull/13839

..
  Current oldest_commit e6aec974fbca64751e0d35a3eafc739d059e9275 (inclusive).
  Current newest_commit a696dcdff0c821af819a5bb6015269de226a7c3f (inclusive).

* framework: Rename old cc files out of the way (`#13842`_)  # This clears the way for the header's history to replace the cc file's history in a future commit.
* framework: Move h files to cc files to preserve history (`#13842`_)  # These files are not yet part of the build, but due to the missing header files this commit will not compile.  This commit strictly speaking is a move, but once combined with a future merge commit will behave more like a copy instead.
* framework: Restore h files to unmodified status (`#13842`_)
* framework: Split context code between h and cc (`#13842`_)  # This passes all tests, but does not pass lint (still disabled).
* framework: De-indent context method definitions two spaces (`#13842`_)
* systems: Fix context whitespace and re-enable linter (`#13842`_)
* Clarify documentation of symbolic::isnan (`#12938`_)
* Fix doc string in show_model.py (`#13847`_)  # It was referring to a urdf file that does not exist
* Pass kwargs through MeshcatVisualizer to meshcat.Visualizer (`#13848`_)
* pydrake: Respect mesh scaling in PlanarSceneGraphVisualizer (`#13836`_)
* Replace drake-visualizer with warning script on prebuilt Docker images (`#13764`_)  # On prebuilt Docker images, rename `drake-visualizer` to `drake-visualizer.image`. Create a `drake-visualizer` script that prints a warning message with a pointer to the renamed file. Resolves #12483 and #13639
* CLion doc: Add section on debugging arbitrary programs (`#13840`_)  # Resolves #13815.
* parsing: Disable $HOME/.sdformat/sdformat.log (`#13850`_)  # Log messages still appear on std::cerr, just not in a file anymore. Libraries should not unconditionally open non-standard files nor create non-standard directories. This removes the "No HOME defined in the environment. Will not log." message when running tests in bazel's hermetic sandbox.
* multibody: Add parsing for PlanarJoint (`#13824`_)  # * Add parsing for PlanarJoint both SDF and URDF
* context: Add cross-reference to cache design docs (`#13852`_)
* Remove cpplint_wrapper and associated test (`#13853`_)  # Resolves #13585
* Add ToExpression to ChebyshevBasisElement (`#13845`_)  # 1. Add ToExpression to ChebyshevBasisElement. 2. Allow using ChebyshevBasisElement as scalar type in Eigen matrix. 3. Add Differentiation and Integration to ChebyshevBasisElement.
* simulator: Warn about time jumps (`#13851`_)  # Related to #13741. * remove a false member * add time jump check as one-time warning * adjust tests that use time jumps * adjust doc
* Remove redundant generalized_acceleration cache from MultibodyPlant (`#13855`_)  # * Remove redundant generalized_acceleration cache.
* PlanarSceneGraphVisualizer: Store convex hulls of meshes (`#13857`_)  # Prior to this commit, we stored all of the vertices of each mesh and then took their convex hull after projecting them to the visualization plane every dt. Now we only store the vertices of the 3D convex hull of each mesh. The 2D convex hull must still be computed at each dt, but, for meshes with lots of interior vertices, it will now be over a much smaller set of points.
* Cassie bench gbench (`#13782`_)  # * Cassie benchmark for mass matrix, inverse & forward dynamics & autodiff. Resolves #10322. h/t Michael Posa and Michael Sherman for earlier draft benchmarks.
* framework: Rename old cc files out of the way (`#13844`_)  # This clears the way for the header's history to replace the cc file's history in a future commit.
* framework: Move h files to cc files to preserve history (`#13844`_)  # These files are not yet part of the build, but due to the missing header files this commit will not compile.  This commit strictly speaking is a move, but once combined with a future merge commit will behave more like a copy instead.
* framework: Restore h files to unmodified status (`#13844`_)
* framework: Split state code between h and cc (`#13844`_)  # This passes all tests, but does not pass lint (still disabled).
* framework: De-indent state method definitions two spaces (`#13844`_)
* framework: Fix state whitespace and re-enable linter (`#13844`_)
