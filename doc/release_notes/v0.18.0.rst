*************
Drake v0.18.0
*************

Announcements
-------------

.. warning::

  On macOS, Drake only supports Python 3.8.  Users **must** read `#13097`_ for
  upgrade instructions.

  When paths are set incorrectly, you will see an error such as this::

      ImportError: Python version mismatch: module was compiled for Python 3.8, but the interpreter version is incompatible: 3.7.7

* RigidBodyPlant and all of the drake "attic" is scheduled for removal on
  2020-09-01 (`#12158`_, `#13030`_).

  * Please see `#12158`_ for details of the timeline, and let us know if this
    will cause a problem.

* tutorials: Add tutorial on AddVisualizationCallback (`#13211`_)
* tutorials: tutorials: Explicitly refer to nbviewer for best browsing experience (`#13120`_)  # Update developer notes section

Breaking changes since v0.17.0
------------------------------

These are breaking changes that did not undergo a deprecation period:

Changes since v0.17.0:
----------------------

Dynamical Systems
~~~~~~~~~~~~~~~~~

* common: common: Use BsplineBasis<T> in BsplineTrajectory<T> (`#13149`_)  # Resolves #13150.
* common: common::polynomial : Add Subsitute(var, Polynomial) (`#13108`_)  # Also drecates Polynomial::IsApprox with Polynomial::CoefficientsAlmostEqual. The new incarnation is different in several ways: - Support multibariate polynomials (as opposed to the univariate restriction of IsApprox) - The new test will faillif the polynomials have different variables. -  The comparison supports either relative or absolute comparisons (with slightly different behavior for treating monomials that don't have a match in the other polynomial.
* common: trajectories: add DiscreteTimeTrajectory (`#13157`_)
* common: trajectories: add Trajectory::has_derivative and EvalDerivative (`#13144`_)  # I've started the NVI pattern here, rather than adding another public virtual. It's inconsistent with the rest of the class, but the goal is to move this direction.  I've moved MakeTrajectory to NVI, as well. Also started trajectory.cc => trajectory is now @tparam default_scalar, instead of @tparam ANY
* common: trajectories: add piecewisepolynomial unary minus (`#13109`_)
* math: math: Add BsplineBasis<T>(const BsplineBasis<double>&) (`#13057`_)  # This is a step towards resolution of #13150.
* math: math: Fix BsplineBasis<Expression>::operator==() (`#13158`_)

* systems: Add a dependency ticket for all sources excluding input ports (`#13088`_)  # * Add dependency ticket for all sources excluding input ports.
* systems: controllers: FittedValueIteration supports MBP+SceneGraph (`#13113`_)  # Takes the input port as an argument, and can ignore the scene graph abstract state (related to #9501)
* systems: controllers: Support for Finite Horizon LQR result as a System (`#13178`_)
* systems: controllers: add python bindings for finite-horizon LQR (`#13145`_)  # as discussed on slack, this uses a work-around to binding the std::unique_ptr member variables in FiniteLQRResult. also includes a few small improvements to finite-horizon LQR, in preparation for the supporting discrete-time systems.
* systems: Add System support for implicit equations (`#13068`_)  # * Implementation of implicit equations with acrobot test.
* systems: controllers: add example of finite horizon LQR working on the acrobot (`#13250`_)  # Also had to remove support for symbolic::Expression in the finite horizon LQR controller, pending resolution of #12253.

New features

Fixes

Mathematical Program
~~~~~~~~~~~~~~~~~~~~

* solvers: Fix memcpy undefined behavior in unconstrained optimization (`#13111`_)  # Calling memcpy on nullptr is undefined.

New features

Fixes

Multibody Dynamics
~~~~~~~~~~~~~~~~~~

* multibody: Implement UniversalMobilizer (`#13054`_)
* multibody: Implements MBP::get_body_poses_output_port() (`#13137`_)
* multibody: Make joint store default value (`#13105`_)  # This is a PR to have the Joint class store a default value and to pass the value to its mobilizer implementation upon construction of the joint implementation. Solves the issue of mobilizers storing default joint positions (#13065)
* multibody: multibody: adds a Propeller model for use with MultibodyPlant (`#13135`_)  # Includes python bindings. Partially resolves #12401.

* geometry,multibody: Add alternate Sphere volume mesh generation (`#13114`_)  # Rather than creating a sphere by sub-dividing *all* edges of the previous level of refinement, we refine only those edges on the surface of the sphere. The resultant mesh has a single interior vertex (at the sphere origin) and all of the resolution increases curvature. In contrast to the interior vertices which increases the number of tets by a factor of 8 each time, this only increases it by a factor of 4. It retains an option to tessellate on the interior as well, but no longer defaults to that. This also provides a mechanism through proximity properties to toggle what type of sphere tessellation is used. An optional parameter (kHydroGroup, "sparse_mesh") has been added which will control whether the sphere gets tessellated on the interior or not (defaults to not). This cascaded to a number of other pieces of code that made use of the sphere. The ellipsoid representation as well as the tests.
* geometry,tools: [geometry] Example for contact-surface profiling: rigid bowl, soft ball (`#13138`_)
* geometry: Refactor QueryObject test (`#13136`_)  # This doesn't change the *nature* of the test. Merely the spelling. It eliminates some of the overhead cruft such that the test harness has direct access to the private/protected elements of QueryObject.
* geometry: Use linear f(x,y,z) on tetrahedron directly instead of barycentric interpolation (`#13140`_)  # * [geometry] MeshFieldLinear uses linear function instead of barycentric interpolation.
* geometry: [geometry] Move mesh_intersection code from .h to .cc (`#13086`_)
* geometry: [geometry] Optimize mesh_intersection to avoid heap allocation by using std::vector as member variables (`#13130`_)
* geometry: geometry_properties: Explicitly test number of copies / moves (`#13232`_)

New features

Fixes

Miscellaneous features and fixes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

* common: common: Add implementations of {min,max}(AutoDiffXd, AutoDiffXd) (`#13112`_)  # Resolves #13082.
* lcmtypes: Add lcmtypes for panda command/status (`#13163`_)
* examples,systems: examples: make Acrobot swing-up with trajectory optimization SNOPT only (`#13252`_)
* examples,tools: quadrotor: Upgrade to Skydio R2 model (`#13050`_)  # provided by Abe Bachrach from Skydio
* examples: Change planar gripper link2 collision geometry to box (`#13185`_)
* examples: Four Bar Linkage example (`#13036`_)  # Adds a planar four bar linkage simulation.

pydrake bindings
~~~~~~~~~~~~~~~~

* bindings: Add python binding for GurobiSolverDetails (`#13152`_)  # Backwards-incompatible: This changes all *SolverDetails structures to be read-only for Python. This was deemed OK to break for now.
* bindings: Add python binding for MosekSolverDetails (`#13151`_)
* bindings: multibody: add python binding for get_body_poses_output_port() (`#13229`_)
* bindings: py common: Expose _DRAKE_ASSERT_IS_ARMED (`#13183`_)
* bindings: py common: Use kDrakeAssertIsArmed instead of _DRAKE_ASSERT_IS_ARMED (`#13195`_)
* bindings: py geometry: Bind QueryObject constructor (`#13156`_)  # Enables writing Python LeafSystems which declare ports using this object
* bindings: py mathematical_program: Add friendlier errors for user-functions (`#13183`_)  # Also makes checks stricter
* bindings: py wrap_pybind_test: Fix test for DefReadUniquePtr (`#13175`_)  # Other minor changes
* bindings: pydrake: Resolve RTTI inconsistency on macOS, restore pydrake Value move (`#13225`_)  # common.value: Move AbstractValue and Value here" (#13217)

New features

Fixes

Build system and dependencies
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

* attic,multibody,tools: parsing: Rewrite package.xml crawl to avoid using @tinydir (`#13180`_)  # The tinydir external is now deprecated and will be removed on 2020-08-01.
* tools: Update meshcat (only) (`#13141`_)  # To get @gizatt's fix for the skydio parsing issue.
* tools: Use dReal-4.20.04.1 (`#13133`_)  # nlopt-2.6.2 introduces new enum value `NUM_RESULTS` and this version handles it.
* tools: drake_visualizer: Install builtin scripts (`#13127`_)  # Put under test, both in Bazel and install
* tools: install.py: Add --pre_clean option for ease of debugging (`#13127`_)
* tools: models: Sort lists alphabetically for better maintainability (`#13223`_)
* tools: pybind: Avoid duplicate linting with `add_pybind_coverage_data` (`#13228`_)
* tools: tools: Disable python imports from ~/.local (pip -U) (`#13190`_)  # On Ubuntu, we purposefully do not use pip.  By removing the homedir from imports, we can ensure more reproducible builds and tests.
* tools: tools: Improve new_release checking heuristics (`#13196`_)
* tools: tools: Trim FCL to only compile the parts we need (`#13230`_)  # Deprecate @octomap external (now unused).
* tools: workspace: Deprecate bitbucket.bzl (`#13193`_)
* tools: workspace: Switch sdformat and ignition_math to GitHub (`#13188`_)
* tools: workspace: Update buildifier to latest release 3.0.0 (`#13198`_)
* tools: workspace: Upgrade lcm to latest commit (`#13199`_)
* workspace: Upgrade fmt to latest release 6.2.0 (`#13200`_)
* workspace: Upgrade pycodestyle to latest release 2.5.0 (`#13197`_)  # Fix new formatting nits and invalid string literals that it now flags. Upgrade semantic_version to latest release 2.8.5.
* third_party: third_party: Remove spurious include path (`#13189`_)  # The default include paths are already correct.  Adding an extra suffix results in "undeclared inclusion" warnings downstream.
* setup,tools: setup,tools: Add Ubuntu 20.04 Focal Fossa (`#13142`_)  # Drake is not officially supported on Ubuntu 20.04 (Focal).  This commit enables CI to run `bazel build //common:essential`, so that we may work towards official support.
* setup: setup: Install /usr/bin/python for Focal source builds (`#13235`_)
* lint: Enable W504 for python (`#13204`_)
* manipulation,tools: models: Move jaco_description meshes to RobotLocomotion/models (`#13222`_)

Newly-deprecated APIs
~~~~~~~~~~~~~~~~~~~~~

* attic,multibody,tools: parsing: Rewrite package.xml crawl to avoid using @tinydir (`#13180`_)  # The tinydir external is now deprecated and will be removed on 2020-08-01.

Removal of deprecated items
~~~~~~~~~~~~~~~~~~~~~~~~~~~

* Remove deprecated code 2020-05 (`#13169`_)
* Remove deprecated code 2020-05 (`#13170`_)
* Remove deprecated code 2020-05 (`#13171`_)
* Remove deprecated code 2020-05 (`#13172`_)
* Remove old (undated) deprecations (`#13233`_)

Notes
-----

This release provides `pre-compiled binaries
<https://github.com/RobotLocomotion/drake/releases/tag/v0.18.0>`__ named
``drake-YYYYMMDD-{bionic|mac}.tar.gz``. See :ref:`Nightly Releases
<nightly-releases>` for instructions on how to use them.

Drake binary releases incorporate a pre-compiled version of `SNOPT
<https://ccom.ucsd.edu/~optimizers/solvers/snopt/>`__ as part of the
`Mathematical Program toolbox
<https://drake.mit.edu/doxygen_cxx/group__solvers.html>`__. Thanks to
Philip E. Gill and Elizabeth Wong for their kind support.

.. _#12158: https://github.com/RobotLocomotion/drake/pull/12158
.. _#13030: https://github.com/RobotLocomotion/drake/pull/13030
.. _#13097: https://github.com/RobotLocomotion/drake/pull/13097

..
  Current oldest_commit 77a7b9437331f1540666b9089395b53da403e4fa (inclusive).
  Current newest_commit bc4638164b9994119f8b50b48d268c172e34bdfe (inclusive).
