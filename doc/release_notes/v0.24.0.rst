.. This document is the template used by tools/dev/relnotes.

*************
Drake v0.24.0
*************

Announcements
-------------

* TBD

Breaking changes since v0.23.0
------------------------------

* De-referencing a drake::EigenPtr no longer checks for nullptr (`#14088`_).
  Users relying on the nullptr checks should add their own before dereferencing.
* The exact exception subclasses thrown by VectorBase changed (`#14101`_).
* BasicVector::DoGetAtIndex changed from protected to private.

Changes since v0.23.0
---------------------

Dynamical Systems
~~~~~~~~~~~~~~~~~

.. <relnotes for systems go here>
[systems,tools] * TBD Convert #warnings to errors (`#14174`_)

New features

* Add System::HasInputPort and System::HasOutputPort (`#14176`_)
* Add DiagramBuilder::GetSystems (`#14066`_)
* Add Context::SetStateAndParametersFrom (`#14156`_)
* Add SimulatorConfig, ApplySimulatorConfig, ExtractSimulatorConfig (`#14103`_, `#14135`_, `#14150`_)
* Add publish_period option to ConnectLcmScope (`#14062`_)

Fixes

* Remove VectorBase::operator[] bounds checking (`#14101`_)
* TBD [move to multibody] Improve error message for bushing gimbal-lock singularity (`#14126`_)
* Improve error message for bushing gimbal-lock singularity (`#14126`_)
* Rename accelerometer_sensor.h to accelerometer.h (`#14185`_)
* Rename gyroscope_sensor.h to gyroscope.h (`#14185`_)

Mathematical Program
~~~~~~~~~~~~~~~~~~~~

.. <relnotes for solvers go here>

New features

* AggregateLinearCosts (`#14190`_)
* AggregateQuadraticAndLinearCosts (`#14165`_)
* GenericPolynomial operators (+, -, \*, /, ==, pow, hash) (`#14053`_, `#14100`_, `#14158`_)

Fixes

* Improve inlining for EigenPtr (`#14088`_)
* Improve inlining for AutoDiffXd::operator*= (`#14171`_)
* Document that CSDP supports SOCP (`#14122`_)

Multibody Dynamics
~~~~~~~~~~~~~~~~~~

.. <relnotes for geometry,multibody go here>
* TBD Migrates volume mesh testing utilities (`#14209`_)  # * migrate volume mesh testing utilities
* TBD Add quadrature class for FEM (`#14202`_)  # Create the API for a general quadrature rule class for FEM applications. Add a concrete class, SimplexGaussianQuadrature that implements the APIs.

* TBD [render] Add normal computation for parsed/generated meshes (`#14035`_)  # - shape_meshes.* - Introduces a new struct: MeshData - it encapsulates more data than the previous "vertex position" and triangle construction. It adds normals and uvs. - Mesh loading parses normal data from the obj (throwing exceptions if normals are missing). - All primitives come with normals. - render_engine_gl.* - Instantiate the OpenGl geometry from MeshData instead of the old IndexBuffer and VertexBuffer types.
* TBD Refactors TamsiContactResults --> ContactSolverResults (`#14069`_)
* TBD Bring global_inverse_kinematics out from attic (`#13921`_)  # Bring global_inverse_kinematics out from attic folder to multibody folder. Rewrite GlobalInverseKinematics using MBP public API.
* TBD Introduce ContactSolver and MBP::set_contact_solver() (`#13958`_)
* TBD [geometry] Add Obb (Oriented Bounding Box) (`#13808`_)
* TBD parsing: Don't warn when re-discovering the same package.xml (`#14089`_)
* TBD [geometry] Bvh(Bounding Volume Hierarchy) uses Obb (`#13978`_)
* TBD multibody/math: Merge all targets into :spatial_algebra (`#14113`_)  # Encapsulates linking artifacts due to dependency cycle
* TBD unit_inertia: Change ReExpress to use frame A instead of frame F (`#14112`_)  # For consistency with rotational_inertia and spatial_inertia
* TBD Move model directives mechanism out of dev (`#14038`_)
* TBD [geometry] Remove the non-BVH interface for rigid-soft mesh intersection (`#14110`_)  # For historical reasons, computing intersection between a soft volume mesh and a rigid surface mesh had two separate APIs. One used broadphase acceleration with a bounding volume hierarchy (BVH) one did not. Both APIs were propagated as a basis for measuring improvement. The need for both APIs is long gone. So, we'll simplify the API and eliminate the slow version. Going forward, improvements should be against strictly the best possible results. This change had several implications: - mesh_intersection_benchmark now only considers one case -- it reports the performance of queries with the *current* BVH implementation. - Unit tests in mesh_intersection_test would exploit the BVH-free API to shorten the tests. They needed to be expanded to use the BVH API. - One test in particular would produce a smoke test confirming that the test could be used with AutoDiffXd-valued meshes. That used the old BVH-free API. In removing that API, we need to be able to build a BVH for an AutoDiffXd-valued mesh. - Bvh and obb (and tests) have been updated to allow constructing a BVH for an AutoDiffXd-valued mesh. - Incidentally, cleaned up names of meshes to match the quantity_F notation.
* TBD This commit applies all of the post-dev changes to model directives: (`#14038`_)  # * Sync with upstream changes * Rewrite to not reference dev * Removing invalid geometry from the jaco (as mentioning it in a data= line causes it to be validity checked) * Factor the scoped names mechanism out of model directives * Rewrite the weld error API to be future-proof against a future refactor.
* TBD Add pydrake bindings for model directives (`#14144`_)  # * Weld error support omitted for simplicity. * Follow-up to #14038 * Completes #13282
* TBD Adds parameters for FixedOffsetFrame (`#14137`_)
* TBD Cleanups of issues revealed in integrating model directives downstream (`#14145`_)
* TBD Utility function that uses AutoDiff and vector differentiation in a non-world frame.  Useful as an independent test for methods such as CalcBiasSpatialAcceleration() and CalcSpatialAcceleration().  Resolves issue #13562 (`#13593`_)
* TBD Code and test for spatial momentum of a plant or subset of bodies (`#13916`_)
* TBD Add unit length constraint on quaternion variables (`#14141`_)
* TBD [proximity] Adds hydroelastic support for Convex shapes (`#14178`_)  # Declaring a Convex shape to be rigid, will now produce a hydroelastic representation. It is treated the same as a more general Mesh. Updated `quad_cube.obj` as it wasn't really a cube; one of the vertex positions was *slightly* out of position.
* TBD Fix unit_quaternion_constraint_test failure on CI (`#14182`_)
* TBD [geometry] Removing the now unused contact_surface_from_level_set functionality (`#14184`_)  # This was stop-gap code that has been supplanted by SceneGraph support and, more generally, this approach has issues; bad relative scales between level set representation and mesh can cause valid contact to not register valid ContactSurfaces. Note: the functionality contained within this PR is wholly contained in the internal namespace.
* TBD Add python binding for static equlibrium problem (`#14140`_)  # Also use ComputeSignedDistancePairwiseClosestPoints() to avoid redundant computation.
* TBD pydrake: Bind some missing multibody plant-related items (`#14192`_)
* TBD pydrake: Bind some missing multibody tree-related items (`#14195`_)
* TBD multibody: Use spatial_algebra.h as the sole header for the package (`#14117`_)  # Including the individual headers one at a time might leave the dot product operations undefined. Use DRAKE_DECLARE_CLASS_TEMPLATE_INSTANTIATIONS_ON_DEFAULT_SCALARS.
* TBD Improve inlining for RotationalInertia::ReExpress (`#14088`_)

New features

* TBD

Fixes

* TBD

Tutorials and examples
~~~~~~~~~~~~~~~~~~~~~~

.. <relnotes for examples,tutorials go here>

* manipulation_station: Add package.xml (`#14164`_)
* manipulation_station: Remove noisy warnings about unsupported joint limits (`#14079`_)

Miscellaneous features and fixes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. <relnotes for common,math,lcm,lcmtypes,manipulation,perception go here>
* TBD find_runfiles: Always return a normalized path (`#14211`_)  # Otherwise, we can get different runfiles paths if you run a binary via `./bazel-bin/target` vs. `bazel-bin/target`

* jaco_description: Add package.xml (`#14134`_)
* yaml: Fix in std::optional handling (`#14076`_)
* yaml: Add support for BsplineBasis and BsplineTrajectory (`#14106`_)

pydrake bindings
~~~~~~~~~~~~~~~~

.. <relnotes for bindings go here>
* TBD Call Ipopt solver explicitly when solving static equilibrium problem (`#14199`_)  # * Call snopt solver explicitly when solving static equilibrium problem.
* TBD Rewrite of MeshcatContactVisualizer (`#14210`_)  # I looked more closely at the code because I hit a bug where the contact force IDs were incrementing unstably even though my scene was in steady state.  It caused flickering contact forces, and ground the performance in meshcat to a halt. I found the current implementation to be unnecessarily complex and inefficient.  This PR cleans it up. As a bonus, I've also added arrow heads to the cylinders, and changed the colors to match the contact forces in drake visualizer.  The overall result improves the visualization quite a bit.

New features

* jupyter: Add joint sliders using publishing callback (`#14059`_)
* meshcat: Add option to set contact cylinder radius (`#14131`_)
* multibody: Allow SpatialVector's to be pickled (`#14104`_)
* solvers: Add vectorized version of EvalBinding (`#14064`_)

Fixes

* multibody: SpatialVector default constructor initializes to NaN (`#14096`_)
* jupyter: Improve descriptive text for joint sliders (`#14130`_)
* Fix missing runtime module imports (`#14072`_, `#14095`_)

Newly bound

* pydrake.math.BsplineBasis (`#14201`_)
* pydrake.math.BsplineTrajectory (`#14201`_)
* pydrake.multibody.math.SpatialAcceleration.ComposeWithMovingFrameAcceleration (`#14193`_)
* pydrake.multibody.math.SpatialAcceleration.Shift (`#14193`_)
* pydrake.multibody.math.SpatialForce.Shift (`#14098`_)
* pydrake.multibody.math.SpatialForce.dot (`#14098`_)
* pydrake.multibody.math.SpatialMomentum.Shift (`#14193`_)
* pydrake.multibody.math.SpatialMomentum.dot (`#14193`_)
* pydrake.multibody.math.SpatialVector arithmetic operators (`#14098`_)
* pydrake.multibody.math.SpatialVelocity.ComposeWithMovingFrameVelocity (`#14098`_)
* pydrake.multibody.math.SpatialVelocity.Shift (`#14098`_)
* pydrake.multibody.math.SpatialVelocity.dot (`#14098`_)
* pydrake.multibody.plant.ContactModel (`#14108`_)
* pydrake.multibody.plant.MultibodyPlant.CalcSpatialMomentumInWorldAboutPoint (`#14078`_)
* pydrake.multibody.plant.MultibodyPlant.GetFloatingBaseBodies (`#14139`_)
* pydrake.multibody.plant.MultibodyPlant.GetFreeBodyPose (`#14166`_)
* pydrake.multibody.plant.MultibodyPlant.get_contact_model (`#14108`_)
* pydrake.multibody.plant.MultibodyPlant.set_contact_model (`#14108`_)
* pydrake.multibody.tree.Body.floating_positions_start (`#14166`_)
* pydrake.multibody.tree.Body.floating_velocities_start (`#14166`_)
* pydrake.multibody.tree.LinearBushingRollPitchYaw (`#14070`_)
* pydrake.multibody.tree.MultibodyForces ctor (`#14193`_)
* pydrake.multibody.tree.MultibodyForces.num_bodies (`#14193`_)
* pydrake.multibody.tree.MultibodyForces.num_velocities (`#14193`_)
* pydrake.multibody.tree.RotationalInertia (many methods) (`#14193`_)
* pydrake.multibody.tree.RotationalInertia.ReExpress (`#14111`_, `#14194`_)
* pydrake.multibody.tree.RotationalInertia.UnitInertia.ReExpress (`#14111`_, `#14194`_)
* pydrake.multibody.tree.SpatialInertia.MakeFromCentralInertia (`#14193`_)
* pydrake.multibody.tree.UnitInertia (many methods) (`#14193`_)
* pydrake.solvers.mathematicalprogram.MathematicalProgram.AddLorentzConeConstraint (`#14119`_)
* pydrake.solvers.mathematicalprogram.MathematicalProgram.AddRotatedLorentzConeConstraint (`#14120`_)

Build system and dependencies
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. <relnotes for attic,cmake,doc,setup,third_party,tools go here>

* Upgrade to Xcode 12 on Catalina (`#14142`_)

  * Disable range-loop-analysis warnings for Clang 10 and Apple Clang 12 (`#14091`_, `#14094`_)

* Upgrade buildifier to latest release 3.5.0 (`#14152`_)
* Upgrade dreal to latest release 4.20.09.1 (`#14083`_)
* Upgrade fcl to latest commit (`#14063`_)
* Upgrade googlebenchmark to latest release (`#14154`_)
* Upgrade ignition_math to latest release 6.6.0 (`#14148`_)
* Upgrade rules_python to latest release 0.0.3 (`#14161`_)
* Upgrade libsdformat to latest release 9.3.0 (`#14147`_)
* Upgrade spdlog to latest release 1.8.1 (`#14153`_)
* Downgrade doxygen to 1.8.15 on macOS (`#14169`_)
* Fix snopt external for Bazel 3.6 (`#14179`_)
* Fix compilation errors vs Eigen 3.3.8 (`#14159`_)
* Cleanup pkg-config path for ibex (`#14109`_)
* Clarify which vector_gen macros are to be used outside of Drake (`#14092`_)

Newly-deprecated APIs
~~~~~~~~~~~~~~~~~~~~~

* drake/math/expmap.h include path (`#14099`_)
* drake/multibody/math/spatial_acceleration.h include path (`#14117`_)
* drake/multibody/math/spatial_force.h include path (`#14117`_)
* drake/multibody/math/spatial_momentum.h include path (`#14117`_)
* drake/multibody/math/spatial_vector.h include path (`#14117`_)
* drake/multibody/math/spatial_velocity.h include path (`#14117`_)
* drake/systems/analysis/simulator_flags.h include path (`#14135`_)
* drake/systems/sensors/accelerometer_sensor.h include path (`#14185`_)
* drake/systems/sensors/gyroscope_sensor.h include path (`#14185`_)
* drake::math::closestExpmap (`#14099`_)
* drake::math::expmap2quat (`#14099`_)
* drake::math::quat2expmap (`#14099`_)
* drake::math::quat2expmapSequence (`#14099`_)
* drake::multibody::math::SpatialVector::ScalarType (`#14188`_)
* drake::systems::Context::FixInputPort() (`#14093`_)
* tools/vector_gen/vector_gen.bzl:drake_cc_vector_gen (`#14092`_)
* tools/vector_gen/vector_gen.bzl:drake_vector_gen_lcm_sources (`#14092`_)
* The numpy external (`#14116`_)

Removal of deprecated items
~~~~~~~~~~~~~~~~~~~~~~~~~~~

* pydrake.geometry.SceneGraphInspector.GetNameByFrameId (`#14128`_)
* pydrake.geometry.SceneGraphInspector.GetNameByGeometryId (`#14128`_)
* schema::Rotation backwards compatibility for rotation_rpy_deg (`#14143`_)
* Automatic conversion and interop between RigidTransform/Isometry3 (`#14128`_)

  * drake::math::RigidTransform::linear
  * drake::math::RigidTransform::matrix
  * drake::math::RigidTransform::operator Isometry3

* All functions within manipulation/util/bot_core_lcm_encode_decode.h (`#14128`_)

  * ::EncodeVector3d
  * ::DecodeVector3d
  * ::EncodeQuaternion
  * ::DecodeQuaternion
  * ::EncodePose
  * ::DecodePose
  * ::EncodeTwist
  * ::DecodeTwist

Notes
-----

This release provides `pre-compiled binaries
<https://github.com/RobotLocomotion/drake/releases/tag/v0.24.0>`__ named
``drake-YYYYMMDD-{bionic|focal|mac}.tar.gz``. See :ref:`Nightly Releases
<nightly-releases>` for instructions on how to use them.

Drake binary releases incorporate a pre-compiled version of `SNOPT
<https://ccom.ucsd.edu/~optimizers/solvers/snopt/>`__ as part of the
`Mathematical Program toolbox
<https://drake.mit.edu/doxygen_cxx/group__solvers.html>`__. Thanks to
Philip E. Gill and Elizabeth Wong for their kind support.

.. <begin issue links>
.. _#13593: https://github.com/RobotLocomotion/drake/pull/13593
.. _#13808: https://github.com/RobotLocomotion/drake/pull/13808
.. _#13916: https://github.com/RobotLocomotion/drake/pull/13916
.. _#13921: https://github.com/RobotLocomotion/drake/pull/13921
.. _#13958: https://github.com/RobotLocomotion/drake/pull/13958
.. _#13978: https://github.com/RobotLocomotion/drake/pull/13978
.. _#14035: https://github.com/RobotLocomotion/drake/pull/14035
.. _#14038: https://github.com/RobotLocomotion/drake/pull/14038
.. _#14053: https://github.com/RobotLocomotion/drake/pull/14053
.. _#14059: https://github.com/RobotLocomotion/drake/pull/14059
.. _#14062: https://github.com/RobotLocomotion/drake/pull/14062
.. _#14063: https://github.com/RobotLocomotion/drake/pull/14063
.. _#14064: https://github.com/RobotLocomotion/drake/pull/14064
.. _#14066: https://github.com/RobotLocomotion/drake/pull/14066
.. _#14069: https://github.com/RobotLocomotion/drake/pull/14069
.. _#14070: https://github.com/RobotLocomotion/drake/pull/14070
.. _#14072: https://github.com/RobotLocomotion/drake/pull/14072
.. _#14076: https://github.com/RobotLocomotion/drake/pull/14076
.. _#14078: https://github.com/RobotLocomotion/drake/pull/14078
.. _#14079: https://github.com/RobotLocomotion/drake/pull/14079
.. _#14083: https://github.com/RobotLocomotion/drake/pull/14083
.. _#14088: https://github.com/RobotLocomotion/drake/pull/14088
.. _#14089: https://github.com/RobotLocomotion/drake/pull/14089
.. _#14091: https://github.com/RobotLocomotion/drake/pull/14091
.. _#14092: https://github.com/RobotLocomotion/drake/pull/14092
.. _#14093: https://github.com/RobotLocomotion/drake/pull/14093
.. _#14094: https://github.com/RobotLocomotion/drake/pull/14094
.. _#14095: https://github.com/RobotLocomotion/drake/pull/14095
.. _#14096: https://github.com/RobotLocomotion/drake/pull/14096
.. _#14098: https://github.com/RobotLocomotion/drake/pull/14098
.. _#14099: https://github.com/RobotLocomotion/drake/pull/14099
.. _#14100: https://github.com/RobotLocomotion/drake/pull/14100
.. _#14101: https://github.com/RobotLocomotion/drake/pull/14101
.. _#14103: https://github.com/RobotLocomotion/drake/pull/14103
.. _#14104: https://github.com/RobotLocomotion/drake/pull/14104
.. _#14106: https://github.com/RobotLocomotion/drake/pull/14106
.. _#14108: https://github.com/RobotLocomotion/drake/pull/14108
.. _#14109: https://github.com/RobotLocomotion/drake/pull/14109
.. _#14110: https://github.com/RobotLocomotion/drake/pull/14110
.. _#14111: https://github.com/RobotLocomotion/drake/pull/14111
.. _#14112: https://github.com/RobotLocomotion/drake/pull/14112
.. _#14113: https://github.com/RobotLocomotion/drake/pull/14113
.. _#14116: https://github.com/RobotLocomotion/drake/pull/14116
.. _#14117: https://github.com/RobotLocomotion/drake/pull/14117
.. _#14119: https://github.com/RobotLocomotion/drake/pull/14119
.. _#14120: https://github.com/RobotLocomotion/drake/pull/14120
.. _#14122: https://github.com/RobotLocomotion/drake/pull/14122
.. _#14126: https://github.com/RobotLocomotion/drake/pull/14126
.. _#14128: https://github.com/RobotLocomotion/drake/pull/14128
.. _#14130: https://github.com/RobotLocomotion/drake/pull/14130
.. _#14131: https://github.com/RobotLocomotion/drake/pull/14131
.. _#14134: https://github.com/RobotLocomotion/drake/pull/14134
.. _#14135: https://github.com/RobotLocomotion/drake/pull/14135
.. _#14137: https://github.com/RobotLocomotion/drake/pull/14137
.. _#14139: https://github.com/RobotLocomotion/drake/pull/14139
.. _#14140: https://github.com/RobotLocomotion/drake/pull/14140
.. _#14141: https://github.com/RobotLocomotion/drake/pull/14141
.. _#14142: https://github.com/RobotLocomotion/drake/pull/14142
.. _#14143: https://github.com/RobotLocomotion/drake/pull/14143
.. _#14144: https://github.com/RobotLocomotion/drake/pull/14144
.. _#14145: https://github.com/RobotLocomotion/drake/pull/14145
.. _#14147: https://github.com/RobotLocomotion/drake/pull/14147
.. _#14148: https://github.com/RobotLocomotion/drake/pull/14148
.. _#14150: https://github.com/RobotLocomotion/drake/pull/14150
.. _#14152: https://github.com/RobotLocomotion/drake/pull/14152
.. _#14153: https://github.com/RobotLocomotion/drake/pull/14153
.. _#14154: https://github.com/RobotLocomotion/drake/pull/14154
.. _#14156: https://github.com/RobotLocomotion/drake/pull/14156
.. _#14158: https://github.com/RobotLocomotion/drake/pull/14158
.. _#14159: https://github.com/RobotLocomotion/drake/pull/14159
.. _#14161: https://github.com/RobotLocomotion/drake/pull/14161
.. _#14164: https://github.com/RobotLocomotion/drake/pull/14164
.. _#14165: https://github.com/RobotLocomotion/drake/pull/14165
.. _#14166: https://github.com/RobotLocomotion/drake/pull/14166
.. _#14169: https://github.com/RobotLocomotion/drake/pull/14169
.. _#14171: https://github.com/RobotLocomotion/drake/pull/14171
.. _#14174: https://github.com/RobotLocomotion/drake/pull/14174
.. _#14176: https://github.com/RobotLocomotion/drake/pull/14176
.. _#14178: https://github.com/RobotLocomotion/drake/pull/14178
.. _#14179: https://github.com/RobotLocomotion/drake/pull/14179
.. _#14182: https://github.com/RobotLocomotion/drake/pull/14182
.. _#14184: https://github.com/RobotLocomotion/drake/pull/14184
.. _#14185: https://github.com/RobotLocomotion/drake/pull/14185
.. _#14188: https://github.com/RobotLocomotion/drake/pull/14188
.. _#14190: https://github.com/RobotLocomotion/drake/pull/14190
.. _#14192: https://github.com/RobotLocomotion/drake/pull/14192
.. _#14193: https://github.com/RobotLocomotion/drake/pull/14193
.. _#14194: https://github.com/RobotLocomotion/drake/pull/14194
.. _#14195: https://github.com/RobotLocomotion/drake/pull/14195
.. _#14199: https://github.com/RobotLocomotion/drake/pull/14199
.. _#14201: https://github.com/RobotLocomotion/drake/pull/14201
.. _#14202: https://github.com/RobotLocomotion/drake/pull/14202
.. _#14209: https://github.com/RobotLocomotion/drake/pull/14209
.. _#14210: https://github.com/RobotLocomotion/drake/pull/14210
.. _#14211: https://github.com/RobotLocomotion/drake/pull/14211
.. <end issue links>

..
  Current oldest_commit 6bd5f8c25cdcbb4049e57ec0f49f6e2c136d864a (exclusive).
  Current newest_commit cd4890d564d1c44107b2c32b8996346eb2e61a23 (inclusive).
