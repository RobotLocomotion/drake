cmake_minimum_required (VERSION 2.6)

pods_find_pkg_config(bullet)

if (MATLAB_FOUND)
  add_rbm_mex(compareParsersmex)
endif (MATLAB_FOUND)

add_executable(urdfKinTest urdfKinTest.cpp)
target_link_libraries(urdfKinTest drakeRBM)
if (bullet_FOUND)
  add_executable(urdfCollisionTest urdfCollisionTest.cpp)
  target_link_libraries(urdfCollisionTest drakeRBM)
endif()

add_executable(urdfManipulatorDynamicsTest urdfManipulatorDynamicsTest.cpp)
target_link_libraries(urdfManipulatorDynamicsTest drakeRBM)

if (NOT WIN32)
  # this test does not compile on MSVC 2010 because of the use of variadic templates
  add_executable(testKinematicsCacheChecks testKinematicsCacheChecks.cpp)
  target_link_libraries(testKinematicsCacheChecks drakeRBM)
  add_test(NAME testKinematicsCacheChecks WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND testKinematicsCacheChecks)
endif()

macro(add_ik_cpp)
  add_executable(${ARGV} ${ARGV}.cpp)
  set_target_properties(${ARGV} PROPERTIES COMPILE_FLAGS "-fPIC")
  target_link_libraries(${ARGV} drakeRigidBodyConstraint drakeIK)
  add_test( NAME ${ARGV} WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${ARGV})
endmacro()

if (gurobi_FOUND)
  add_ik_cpp(testApproximateIK)
endif(gurobi_FOUND)

if (snopt_c_FOUND)
  add_ik_cpp(testIK)
  add_ik_cpp(testIKMoreConstraints)
  add_ik_cpp(testIKpointwise)
  add_ik_cpp(testIKtraj)
endif(snopt_c_FOUND)

add_executable(debugManipulatorDynamics debugManipulatorDynamics.cpp)
target_link_libraries(debugManipulatorDynamics drakeRBM)

add_executable(benchmarkRigidBodyTree benchmarkRigidBodyTree.cpp)
target_link_libraries(benchmarkRigidBodyTree drakeRBM)

if (MATLAB_FOUND)
  macro(add_ikoptions_mex)
    add_mex(${ARGV} ${ARGV}.cpp)
    target_link_libraries(${ARGV} drakeRBM drakeMexUtil drakeIKoptions)
  endmacro()
  add_ikoptions_mex(testIKoptionsmex)
endif(MATLAB_FOUND)

add_executable(bullet_collision_zero_rad_sphere_test bullet_collision_zero_rad_sphere_test.cpp)
target_link_libraries(bullet_collision_zero_rad_sphere_test drakeRBM)
add_test(NAME bullet_collision_zero_rad_sphere_test COMMAND bullet_collision_zero_rad_sphere_test)

if (LCM_FOUND)
  if (GTEST_FOUND)
    add_executable(testMassSpringDamper testMassSpringDamper.cpp)
    target_link_libraries(testMassSpringDamper drakeRBSystem ${GTEST_BOTH_LIBRARIES})
    add_test(NAME testMassSpringDamper COMMAND testMassSpringDamper)
  endif(GTEST_FOUND)

  if (bullet_FOUND)
    add_executable(testLidar lidarTest.cpp)
    target_link_libraries(testLidar drakeRBSystem)
    add_test(NAME testLidar COMMAND testLidar)
  endif(bullet_FOUND)

  if (GTEST_FOUND)
    add_executable(testAccelerometer testAccelerometer.cpp)
    target_link_libraries(testAccelerometer drakeRBSystem ${GTEST_BOTH_LIBRARIES})
    add_test(NAME testAccelerometer COMMAND testAccelerometer)

    add_executable(testGyroscope testGyroscope.cpp)
    target_link_libraries(testGyroscope drakeRBSystem ${GTEST_BOTH_LIBRARIES})
    add_test(NAME testGyroscope COMMAND testGyroscope)

    add_executable(testMagnetometer testMagnetometer.cpp)
    target_link_libraries(testMagnetometer drakeRBSystem ${GTEST_BOTH_LIBRARIES})
    add_test(NAME testMagnetometer COMMAND testMagnetometer)

    add_executable(compareRigidBodySystems compareRigidBodySystems.cpp)
    target_link_libraries(compareRigidBodySystems drakeRBSystem ${GTEST_BOTH_LIBRARIES})
    add_test(NAME compareAcrobotURDFtoSDF COMMAND compareRigidBodySystems Acrobot.urdf Acrobot.sdf WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}/examples/Acrobot")

    if (snopt_c_FOUND)
      add_test(NAME comparePriusURDFtoSDF COMMAND compareRigidBodySystems prius.sdf prius.urdf 0 0 0.378326 WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}/examples/Cars/prius")
    endif (snopt_c_FOUND)
  endif (GTEST_FOUND)
endif (LCM_FOUND)

if (GTEST_FOUND)
  add_executable(testXmlUtil testXmlUtil.cpp)
  target_link_libraries(testXmlUtil drakeXMLUtil ${GTEST_BOTH_LIBRARIES})
  add_test(NAME testXmlUtil COMMAND testXmlUtil)
endif (GTEST_FOUND)

add_matlab_test(NAME systems/plants/test/addRobotFromURDFStringTest COMMAND addRobotFromURDFStringTest)
add_matlab_test(NAME systems/plants/test/andresFallingBlockTest COMMAND andresFallingBlockTest)
add_matlab_test(NAME systems/plants/test/bodyKinTest COMMAND bodyKinTest)
add_matlab_test(NAME systems/plants/test/bullet_collision_all_bodies_jac_test COMMAND bullet_collision_all_bodies_jac_test)
add_matlab_test(NAME systems/plants/test/bullet_collision_closest_distance_jac_test COMMAND bullet_collision_closest_distance_jac_test)
add_matlab_test(NAME systems/plants/test/bullet_collision_zero_rad_sphere_test COMMAND bullet_collision_zero_rad_sphere_test)
add_matlab_test(NAME systems/plants/test/bullet_raycast_test COMMAND bullet_raycast_test)
add_matlab_test(NAME systems/plants/test/collidingPointsTest COMMAND collidingPointsTest)
add_matlab_test(NAME systems/plants/test/collisionDetectBoxTest COMMAND collisionDetectBoxTest)
add_matlab_test(NAME systems/plants/test/collisionDetectCHullTest COMMAND collisionDetectCHullTest)
add_matlab_test(NAME systems/plants/test/collisionDetectCapsuleTest COMMAND collisionDetectCapsuleTest)
add_matlab_test(NAME systems/plants/test/collisionDetectGradTest COMMAND collisionDetectGradTest)
add_matlab_test(NAME systems/plants/test/collisionDetectSphereTest COMMAND collisionDetectSphereTest)
add_matlab_test(NAME systems/plants/test/compareParsers COMMAND compareParsers)
add_matlab_test(NAME systems/plants/test/contactNormalsTest COMMAND contactNormalsTest)
add_matlab_test(NAME systems/plants/test/contactSensorTest COMMAND contactSensorTest)
add_matlab_test(NAME systems/plants/test/coordinateSystemTest COMMAND coordinateSystemTest)
add_matlab_test(NAME systems/plants/test/doublePendWBiceptSpring COMMAND doublePendWBiceptSpring)
add_matlab_test(NAME systems/plants/test/fallingBrickLCP COMMAND fallingBrickLCP)
add_matlab_test(NAME systems/plants/test/fallingCapsulesTest COMMAND fallingCapsulesTest)
add_matlab_test(NAME systems/plants/test/ignoreSelfCollisionsTest COMMAND ignoreSelfCollisionsTest)
add_matlab_test(NAME systems/plants/test/linearize_test COMMAND linearize_test)
add_matlab_test(NAME systems/plants/test/momentumTest COMMAND momentumTest)
add_matlab_test(NAME systems/plants/test/moveSpatialMassMatrixTest COMMAND moveSpatialMassMatrixTest)
add_matlab_test(NAME systems/plants/test/multiContactTest COMMAND multiContactTest)
add_matlab_test(NAME systems/plants/test/multiRobotTest COMMAND multiRobotTest)
add_matlab_test(NAME systems/plants/test/simulinkDependency COMMAND simulinkDependency)
add_matlab_test(NAME systems/plants/test/springPendulum COMMAND springPendulum)
add_matlab_test(NAME systems/plants/test/terrainInterpTest COMMAND terrainInterpTest)
add_matlab_test(NAME systems/plants/test/terrainTest COMMAND terrainTest)
add_matlab_test(NAME systems/plants/test/testAnalyticalJacobian COMMAND testAnalyticalJacobian)
add_matlab_test(NAME systems/plants/test/testApproximateIK COMMAND testApproximateIK)
add_matlab_test(NAME systems/plants/test/testBrickKinematics COMMAND testBrickKinematics)
add_matlab_test(NAME systems/plants/test/testCOM COMMAND testCOM)
add_matlab_test(NAME systems/plants/test/testCenterOfMassJacobianDotTimesV COMMAND testCenterOfMassJacobianDotTimesV)
add_matlab_test(NAME systems/plants/test/testCentroidalMomentumMatrix COMMAND testCentroidalMomentumMatrix)
add_matlab_test(NAME systems/plants/test/testCentroidalMomentumMatrixDotTimesV COMMAND testCentroidalMomentumMatrixDotTimesV)
add_matlab_test(NAME systems/plants/test/testCollisionDetectFromPoints COMMAND testCollisionDetectFromPoints)
add_matlab_test(NAME systems/plants/test/testCollisionFilterGroups COMMAND testCollisionFilterGroups)
add_matlab_test(NAME systems/plants/test/testContactConstraintsMex COMMAND testContactConstraintsMex)
add_matlab_test(NAME systems/plants/test/testFindAncestorBodies COMMAND testFindAncestorBodies)
add_matlab_test(NAME systems/plants/test/testFindKinematicPath COMMAND testFindKinematicPath)
add_matlab_test(NAME systems/plants/test/testFloatingBaseDynamics COMMAND testFloatingBaseDynamics)
add_matlab_test(NAME systems/plants/test/testFloatingMassSpringDamperForceGradients COMMAND testFloatingMassSpringDamperForceGradients)
add_matlab_test(NAME systems/plants/test/testForwardJacDotTimesV COMMAND testForwardJacDotTimesV)
add_matlab_test(NAME systems/plants/test/testForwardKin COMMAND testForwardKin)
add_matlab_test(NAME systems/plants/test/testForwardKinRot COMMAND testForwardKinRot)
add_matlab_test(NAME systems/plants/test/testFrameParser COMMAND testFrameParser)
add_matlab_test(NAME systems/plants/test/testGeometricJacobian COMMAND testGeometricJacobian)
add_matlab_test(NAME systems/plants/test/testGeometricJacobianDotTimesV COMMAND testGeometricJacobianDotTimesV)
add_matlab_test(NAME systems/plants/test/testGeometricJacobianDotV COMMAND testGeometricJacobianDotV)
add_matlab_test(NAME systems/plants/test/testGradients COMMAND testGradients)
add_matlab_test(NAME systems/plants/test/testHybridMode COMMAND testHybridMode)
add_matlab_test(NAME systems/plants/test/testHybridRBM COMMAND testHybridRBM)
add_matlab_test(NAME systems/plants/test/testIK COMMAND testIK PROPERTIES  TIMEOUT  600)
add_matlab_test(NAME systems/plants/test/testIKoptions COMMAND testIKoptions)
add_matlab_test(NAME systems/plants/test/testIKtraj COMMAND testIKtraj PROPERTIES  TIMEOUT  1500)
add_matlab_test(NAME systems/plants/test/testIndices COMMAND testIndices)
add_matlab_test(NAME systems/plants/test/testInertiasInWorldFrame COMMAND testInertiasInWorldFrame)
add_matlab_test(NAME systems/plants/test/testJointLimitConstraintsmex COMMAND testJointLimitConstraintsmex)
add_matlab_test(NAME systems/plants/test/testJointLimits COMMAND testJointLimits)
add_matlab_test(NAME systems/plants/test/testManipulatorDynamics COMMAND testManipulatorDynamics)
add_matlab_test(NAME systems/plants/test/testMassSpringDamper COMMAND testMassSpringDamper)
add_matlab_test(NAME systems/plants/test/testMassSpringDamperDynamicsGradients COMMAND testMassSpringDamperDynamicsGradients)
add_matlab_test(NAME systems/plants/test/testMassSpringDamperForceGradients COMMAND testMassSpringDamperForceGradients)
add_matlab_test(NAME systems/plants/test/testMassSpringDamperThrust COMMAND testMassSpringDamperThrust)
add_matlab_test(NAME systems/plants/test/testMassSpringDamperTrajOpt COMMAND testMassSpringDamperTrajOpt)
add_matlab_test(NAME systems/plants/test/testMex COMMAND testMex)
add_matlab_test(NAME systems/plants/test/testParseBodyOrFrameID COMMAND testParseBodyOrFrameID)
add_matlab_test(NAME systems/plants/test/testPositionConstraintsmex COMMAND testPositionConstraintsmex)
add_matlab_test(NAME systems/plants/test/testPositionControlGradients COMMAND testPositionControlGradients)
add_matlab_test(NAME systems/plants/test/testRelativeTwist COMMAND testRelativeTwist)
add_matlab_test(NAME systems/plants/test/testRigidBodyBluffBody COMMAND testRigidBodyBluffBody)
add_matlab_test(NAME systems/plants/test/testRigidBodyInertialMeasurementUnit COMMAND testRigidBodyInertialMeasurementUnit)
add_matlab_test(NAME systems/plants/test/testRigidBodyPassByValue COMMAND testRigidBodyPassByValue)
add_matlab_test(NAME systems/plants/test/testRigidBodyPropellor COMMAND testRigidBodyPropellor)
add_matlab_test(NAME systems/plants/test/testRigidBodyWingChangingParams COMMAND testRigidBodyWingChangingParams)
add_matlab_test(NAME systems/plants/test/testRigidBodyWingWithControlSurface COMMAND testRigidBodyWingWithControlSurface)
add_matlab_test(NAME systems/plants/test/testRigidBodyWingWithControlSurfaceOnlyControlSurface COMMAND testRigidBodyWingWithControlSurfaceOnlyControlSurface)
add_matlab_test(NAME systems/plants/test/testSpatialAccelerations COMMAND testSpatialAccelerations)
add_matlab_test(NAME systems/plants/test/testSurfaceTangentsMex COMMAND testSurfaceTangentsMex)
add_matlab_test(NAME systems/plants/test/testTerrainContactJacobianDotTimesV COMMAND testTerrainContactJacobianDotTimesV)
add_matlab_test(NAME systems/plants/test/testThrust COMMAND testThrust)
add_matlab_test(NAME systems/plants/test/testTorsionalSpring COMMAND testTorsionalSpring)
add_matlab_test(NAME systems/plants/test/testTorsionalSpringGradient COMMAND testTorsionalSpringGradient)
add_matlab_test(NAME systems/plants/test/testURDFmex COMMAND testURDFmex)
add_matlab_test(NAME systems/plants/test/testWing COMMAND testWing)
add_matlab_test(NAME systems/plants/test/testWingForceGradients COMMAND testWingForceGradients)
add_matlab_test(NAME systems/plants/test/testdHomogTrans COMMAND testdHomogTrans)
add_matlab_test(NAME systems/plants/test/testdTransformSpatialMotion COMMAND testdTransformSpatialMotion)
add_matlab_test(NAME systems/plants/test/timeSteppingRigidBodyManipulatorFramesTest COMMAND timeSteppingRigidBodyManipulatorFramesTest)
