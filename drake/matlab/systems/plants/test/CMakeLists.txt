if(Matlab_FOUND)
  add_rbm_mex(compareParsersmex)

  macro(add_ikoptions_mex)
    drake_add_mex(${ARGV} ${ARGV}.cpp)
    target_link_libraries(${ARGV} drakeRBM drakeMexUtil drakeIKoptions)
  endmacro()
  add_ikoptions_mex(testIKoptionsmex)
endif()

drake_find_package(avl CONFIG)
drake_find_package(xfoil CONFIG)

drake_add_matlab_test(NAME systems/plants/test/addRobotFromURDFStringTest OPTIONAL bullet COMMAND addRobotFromURDFStringTest)
drake_add_matlab_test(NAME systems/plants/test/andresFallingBlockTest OPTIONAL bullet COMMAND andresFallingBlockTest SIZE large)
drake_add_matlab_test(NAME systems/plants/test/bodyKinTest OPTIONAL bullet COMMAND bodyKinTest)
drake_add_matlab_test(NAME systems/plants/test/bullet_collision_all_bodies_jac_test REQUIRES bullet COMMAND bullet_collision_all_bodies_jac_test)
drake_add_matlab_test(NAME systems/plants/test/bullet_collision_closest_distance_jac_test REQUIRES bullet lcm libbot COMMAND bullet_collision_closest_distance_jac_test)
drake_add_matlab_test(NAME systems/plants/test/bullet_collision_zero_rad_sphere_test REQUIRES bullet COMMAND bullet_collision_zero_rad_sphere_test)
drake_add_matlab_test(NAME systems/plants/test/bullet_raycast_test REQUIRES bullet COMMAND bullet_raycast_test)
# drake_add_matlab_test(NAME systems/plants/test/collidingPointsTest REQUIRES bullet lcm COMMAND collidingPointsTest)  # FIXME: see #2320
drake_add_matlab_test(NAME systems/plants/test/collisionDetectBoxTest REQUIRES bullet lcm libbot COMMAND collisionDetectBoxTest)
drake_add_matlab_test(NAME systems/plants/test/collisionDetectCHullTest REQUIRES bullet lcm libbot COMMAND collisionDetectCHullTest)
drake_add_matlab_test(NAME systems/plants/test/collisionDetectCapsuleTest REQUIRES bullet lcm libbot COMMAND collisionDetectCapsuleTest)
drake_add_matlab_test(NAME systems/plants/test/collisionDetectGradTest REQUIRES lcm libbot OPTIONAL bullet COMMAND collisionDetectGradTest)
drake_add_matlab_test(NAME systems/plants/test/collisionDetectSphereTest REQUIRES bullet lcm libbot COMMAND collisionDetectSphereTest)
drake_add_matlab_test(NAME systems/plants/test/compareParsers REQUIRES avl spotless xfoil OPTIONAL bullet COMMAND compareParsers)
drake_add_matlab_test(NAME systems/plants/test/contactNormalsTest OPTIONAL bullet COMMAND contactNormalsTest)
drake_add_matlab_test(NAME systems/plants/test/contactSensorTest REQUIRES snopt OPTIONAL gurobi COMMAND contactSensorTest)
drake_add_matlab_test(NAME systems/plants/test/coordinateSystemTest OPTIONAL bullet gurobi COMMAND coordinateSystemTest SIZE large)
drake_add_matlab_test(NAME systems/plants/test/fallingBrickLCP OPTIONAL bullet gurobi snopt COMMAND fallingBrickLCP)
drake_add_matlab_test(NAME systems/plants/test/fallingCapsulesTest REQUIRES snopt OPTIONAL bullet gurobi COMMAND fallingCapsulesTest SIZE large)
drake_add_matlab_test(NAME systems/plants/test/ignoreSelfCollisionsTest OPTIONAL bullet COMMAND ignoreSelfCollisionsTest)
drake_add_matlab_test(NAME systems/plants/test/linearize_test COMMAND linearize_test)
drake_add_matlab_test(NAME systems/plants/test/momentumTest OPTIONAL gurobi COMMAND momentumTest)
drake_add_matlab_test(NAME systems/plants/test/moveSpatialMassMatrixTest COMMAND moveSpatialMassMatrixTest)
drake_add_matlab_test(NAME systems/plants/test/multiRobotTest OPTIONAL bullet gurobi snopt COMMAND multiRobotTest)
drake_add_matlab_test(NAME systems/plants/test/simulinkDependency OPTIONAL bullet snopt COMMAND simulinkDependency)
drake_add_matlab_test(NAME systems/plants/test/testApproximateIK OPTIONAL bullet gurobi COMMAND testApproximateIK)
drake_add_matlab_test(NAME systems/plants/test/testBrickKinematics OPTIONAL bullet COMMAND testBrickKinematics)
drake_add_matlab_test(NAME systems/plants/test/testCOM OPTIONAL bullet COMMAND testCOM)
drake_add_matlab_test(NAME systems/plants/test/testCenterOfMassJacobianDotTimesV OPTIONAL bullet COMMAND testCenterOfMassJacobianDotTimesV)
drake_add_matlab_test(NAME systems/plants/test/testCentroidalMomentumMatrix OPTIONAL bullet COMMAND testCentroidalMomentumMatrix)
drake_add_matlab_test(NAME systems/plants/test/testCentroidalMomentumMatrixDotTimesV OPTIONAL bullet COMMAND testCentroidalMomentumMatrixDotTimesV)
drake_add_matlab_test(NAME systems/plants/test/testCollisionDetectFromPoints REQUIRES bullet snopt OPTIONAL gurobi COMMAND testCollisionDetectFromPoints)
drake_add_matlab_test(NAME systems/plants/test/testCollisionFilterGroups OPTIONAL bullet COMMAND testCollisionFilterGroups)
drake_add_matlab_test(NAME systems/plants/test/testContactConstraintsMex REQUIRES bullet COMMAND testContactConstraintsMex)
drake_add_matlab_test(NAME systems/plants/test/testFindAncestorBodies OPTIONAL bullet COMMAND testFindAncestorBodies)
drake_add_matlab_test(NAME systems/plants/test/testFindKinematicPath OPTIONAL bullet COMMAND testFindKinematicPath)
drake_add_matlab_test(NAME systems/plants/test/testFloatingBaseDynamics OPTIONAL bullet gurobi snopt COMMAND testFloatingBaseDynamics)
drake_add_matlab_test(NAME systems/plants/test/testFloatingMassSpringDamperForceGradients OPTIONAL bullet COMMAND testFloatingMassSpringDamperForceGradients)
drake_add_matlab_test(NAME systems/plants/test/testForwardJacDotTimesV OPTIONAL bullet COMMAND testForwardJacDotTimesV)
drake_add_matlab_test(NAME systems/plants/test/testForwardKinRot OPTIONAL bullet COMMAND testForwardKinRot)
drake_add_matlab_test(NAME systems/plants/test/testFrameParser OPTIONAL bullet COMMAND testFrameParser)
drake_add_matlab_test(NAME systems/plants/test/testGeometricJacobian OPTIONAL bullet COMMAND testGeometricJacobian)
drake_add_matlab_test(NAME systems/plants/test/testGeometricJacobianDotTimesV OPTIONAL bullet COMMAND testGeometricJacobianDotTimesV)
drake_add_matlab_test(NAME systems/plants/test/testGeometricJacobianDotV OPTIONAL bullet COMMAND testGeometricJacobianDotV)
drake_add_matlab_test(NAME systems/plants/test/testGradients OPTIONAL bullet COMMAND testGradients)
drake_add_matlab_test(NAME systems/plants/test/testHybridMode OPTIONAL bullet snopt COMMAND testHybridMode)
drake_add_matlab_test(NAME systems/plants/test/testHybridRBM OPTIONAL bullet snopt COMMAND testHybridRBM)
drake_add_matlab_test(NAME systems/plants/test/testIKoptions OPTIONAL bullet COMMAND testIKoptions)
drake_add_matlab_test(NAME systems/plants/test/testIndices OPTIONAL bullet COMMAND testIndices)
drake_add_matlab_test(NAME systems/plants/test/testJointLimitConstraintsmex REQUIRES spotless OPTIONAL bullet snopt COMMAND testJointLimitConstraintsmex)
drake_add_matlab_test(NAME systems/plants/test/testJointLimits OPTIONAL bullet COMMAND testJointLimits)
drake_add_matlab_test(NAME systems/plants/test/testManipulatorDynamics OPTIONAL bullet COMMAND testManipulatorDynamics)
drake_add_matlab_test(NAME systems/plants/test/testMassSpringDamper OPTIONAL bullet COMMAND testMassSpringDamper)
drake_add_matlab_test(NAME systems/plants/test/testMassSpringDamperDynamicsGradients OPTIONAL bullet COMMAND testMassSpringDamperDynamicsGradients)
drake_add_matlab_test(NAME systems/plants/test/testMassSpringDamperForceGradients OPTIONAL bullet COMMAND testMassSpringDamperForceGradients)
drake_add_matlab_test(NAME systems/plants/test/testMassSpringDamperTrajOpt OPTIONAL bullet snopt COMMAND testMassSpringDamperTrajOpt)
drake_add_matlab_test(NAME systems/plants/test/testMex OPTIONAL bullet COMMAND testMex)
drake_add_matlab_test(NAME systems/plants/test/testParseBodyOrFrameID OPTIONAL bullet COMMAND testParseBodyOrFrameID)
drake_add_matlab_test(NAME systems/plants/test/testPositionConstraintsmex OPTIONAL bullet COMMAND testPositionConstraintsmex)
drake_add_matlab_test(NAME systems/plants/test/testPositionControlGradients OPTIONAL bullet gurobi COMMAND testPositionControlGradients)
drake_add_matlab_test(NAME systems/plants/test/testRelativeTwist OPTIONAL bullet COMMAND testRelativeTwist)
drake_add_matlab_test(NAME systems/plants/test/testRigidBodyBluffBody REQUIRES spotless OPTIONAL bullet COMMAND testRigidBodyBluffBody)
# drake_add_matlab_test(NAME systems/plants/test/testRigidBodyInertialMeasurementUnit OPTIONAL bullet COMMAND testRigidBodyInertialMeasurementUnit)  # FIXME: see #3313
drake_add_matlab_test(NAME systems/plants/test/testRigidBodyPassByValue OPTIONAL bullet COMMAND testRigidBodyPassByValue)
drake_add_matlab_test(NAME systems/plants/test/testRigidBodyPropellor OPTIONAL bullet COMMAND testRigidBodyPropellor)
drake_add_matlab_test(NAME systems/plants/test/testRigidBodyWingChangingParams REQUIRES spotless OPTIONAL bullet COMMAND testRigidBodyWingChangingParams)
drake_add_matlab_test(NAME systems/plants/test/testRigidBodyWingWithControlSurface OPTIONAL bullet COMMAND testRigidBodyWingWithControlSurface)
drake_add_matlab_test(NAME systems/plants/test/testRigidBodyWingWithControlSurfaceOnlyControlSurface OPTIONAL bullet COMMAND testRigidBodyWingWithControlSurfaceOnlyControlSurface)
drake_add_matlab_test(NAME systems/plants/test/testSpatialAccelerations OPTIONAL bullet COMMAND testSpatialAccelerations)
drake_add_matlab_test(NAME systems/plants/test/testSurfaceTangentsMex REQUIRES bullet COMMAND testSurfaceTangentsMex)
drake_add_matlab_test(NAME systems/plants/test/testTerrainContactJacobianDotTimesV OPTIONAL bullet COMMAND testTerrainContactJacobianDotTimesV)
drake_add_matlab_test(NAME systems/plants/test/testThrust OPTIONAL bullet COMMAND testThrust)
drake_add_matlab_test(NAME systems/plants/test/testTorsionalSpring OPTIONAL bullet COMMAND testTorsionalSpring)
drake_add_matlab_test(NAME systems/plants/test/testTorsionalSpringGradient OPTIONAL bullet COMMAND testTorsionalSpringGradient)
# drake_add_matlab_test(NAME systems/plants/test/testURDFmex COMMAND testURDFmex)  # FIXME: see #2013
drake_add_matlab_test(NAME systems/plants/test/testWing REQUIRES avl xfoil OPTIONAL bullet COMMAND testWing)
drake_add_matlab_test(NAME systems/plants/test/testWingForceGradients REQUIRES avl xfoil OPTIONAL bullet COMMAND testWingForceGradients)
drake_add_matlab_test(NAME systems/plants/test/testdHomogTrans OPTIONAL bullet COMMAND testdHomogTrans)
drake_add_matlab_test(NAME systems/plants/test/testdTransformSpatialMotion OPTIONAL bullet COMMAND testdTransformSpatialMotion)
drake_add_matlab_test(NAME systems/plants/test/timeSteppingRigidBodyManipulatorFramesTest OPTIONAL bullet gurobi snopt COMMAND timeSteppingRigidBodyManipulatorFramesTest)
drake_add_matlab_test(NAME systems/plants/test/world_link_test OPTIONAL bullet COMMAND world_link_test)

drake_add_matlab_test(NAME systems/plants/test/doublePendWBiceptSpring COMMAND doublePendWBiceptSpring)
drake_add_matlab_test(NAME systems/plants/test/springPendulum COMMAND springPendulum)
drake_add_matlab_test(NAME systems/plants/test/terrainInterpTest COMMAND terrainInterpTest)
drake_add_matlab_test(NAME systems/plants/test/terrainTest COMMAND terrainTest)
drake_add_matlab_test(NAME systems/plants/test/testAnalyticalJacobian COMMAND testAnalyticalJacobian)
drake_add_matlab_test(NAME systems/plants/test/testForwardKin COMMAND testForwardKin SIZE large)
drake_add_matlab_test(NAME systems/plants/test/testIK REQUIRES snopt COMMAND testIK)
drake_add_matlab_test(NAME systems/plants/test/testIKtraj COMMAND testIKtraj SIZE large)
drake_add_matlab_test(NAME systems/plants/test/testInertiasInWorldFrame COMMAND testInertiasInWorldFrame)
drake_add_matlab_test(NAME systems/plants/test/testMassSpringDamperThrust COMMAND testMassSpringDamperThrust)

